var websocket,PAGENAME="",gateway=window.location.port?`ws://${window.location.hostname}:${window.location.port}/ws`:`ws://${window.location.hostname}/ws`,websck_is_connected=!1,millis_esp=0,WSCONNECTED=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=(WSCONNECTED=0,0),GET_DATA_SUMAR=5;function onOpenWS(e){websck_is_connected=1,setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),console.log("Connection opened")}function onCloseWS(e){websck_is_connected=0,console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpenWS,websocket.onclose=onCloseWS,websocket.onmessage=onMessageWS}function onMessageWS(e){var t=JSON.parse(e.data);if(console.log(t),1==t.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),t=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==t.hasOwnProperty("cMs")&&(millis_esp=parseInt(t.cMs,10)),1==t.hasOwnProperty("Local")&&(isLOCAL=t.Local),1==t.hasOwnProperty("SIGNALPWR")&&(RSSI=t.SIGNALPWR),1==t.hasOwnProperty("wsCnt")&&(WSCONNECTED=t.wsCnt);var a=document.getElementById("idcMillis");a&&(a.innerHTML=millis_esp+" - ðŸ“¶ "+RSSI+"% ðŸ”´ LIVE ("+WSCONNECTED+")"),"dashboard"==PAGENAME&&1==t.hasOwnProperty("live_data")&&parseDashParamIndex(t),t=null}function pool_info_page(){if(!ERROR_INSTANCE&&websck_is_connected){var e={REQUEST_INFO:GET_DATA_SUMAR},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,websck_is_connected&&setTimeout(function(){pool_info_page()},2e3)}}function checkMillis(){if(!ERROR_INSTANCE){var e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,setTimeout(checkMillis,5e3))}}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function loadWeather(){const e=new Date;var t;$.get("../php/injectJson.php",function(a){t=JSON.parse(a);const o=new Date(t.Day0.sunrise),l=new Date(t.Day0.sunset);1==(e>o&&e<l)?($("#weatherTodayDate").html('<i class="fas fa-sun" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+t.Day0.dayName),$("#weatherTodayDayNarative").html(t.Day0.day),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+t.Day0.iconDay+"&idxlbl="+t.Day0.phraseDay)):($("#weatherTodayDate").html('<i class="fas fa-moon" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+t.Day0.nightName),$("#weatherTodayDayNarative").html(t.Day0.night),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+t.Day0.iconNight+"&idxlbl="+t.Day0.phraseNight+"&forceNight=true")),$("#weatherTodayTempDay").html(t.Day0.dayTemp),$("#weatherTodayTempNight").html(t.Day0.nightTemp),$("#weatherday1std").html(t.Day1.dayName),$("#weatherday2std").html(t.Day2.dayName),$("#weatherday3std").html(t.Day3.dayName),$("#weatherday4std").html(t.Day4.dayName),$("#weatherDate1std").html(t.Day1.validDate),$("#weatherDate2std").html(t.Day2.validDate),$("#weatherDate3std").html(t.Day3.validDate),$("#weatherDate4std").html(t.Day4.validDate),$("#narrative1Std").html(t.Day1.phraseDay),$("#narrative2Std").html(t.Day2.phraseDay),$("#narrative3Std").html(t.Day3.phraseDay),$("#narrative4Std").html(t.Day4.phraseDay),$("#temp1Std").html(t.Day1.dayTemp+"Âº"),$("#temp2Std").html(t.Day2.dayTemp+"Âº"),$("#temp3Std").html(t.Day3.dayTemp+"Âº"),$("#temp4Std").html(t.Day4.dayTemp+"Âº"),$("#icon1Std").attr("src","../weather/logo/weather_logo.php?idx="+t.Day1.iconDay+"&forceDay=true&idxlbl="+t.Day1.phraseDay),$("#icon2Std").attr("src","../weather/logo/weather_logo.php?idx="+t.Day2.iconDay+"&forceDay=true&idxlbl="+t.Day2.phraseDay),$("#icon3Std").attr("src","../weather/logo/weather_logo.php?idx="+t.Day3.iconDay+"&forceDay=true&idxlbl="+t.Day3.phraseDay),$("#icon4Std").attr("src","../weather/logo/weather_logo.php?idx="+t.Day4.iconDay+"&forceDay=true&idxlbl="+t.Day4.phraseDay)})}function parseDashParamIndex(e){if(null!=e){var t=e.live_data,a="";$("#lbl_dormitor_temp").html(t.TEMP_DORMITOR+"<label>ÂºC</label>"),$("#lbl_dormitor2_temp").html(t.TEMP_DORMITOR2+"<label>ÂºC</label>"),$("#lbl_living_temp").html(t.TEMP_HOL+"<label>ÂºC</label>"),$("#lbl_ext_temp").html(t.TEMP_EXTERN+"<label>ÂºC</label>"),$("#lbl_matrix_temp").html(temp_resimtita(parseFloat(t.MATRIX_INDOOR),parseFloat(t.HOL_HUMIDITY),.2)+"<label>ÂºC</label>"),$("#lbl_thermostatset_temp").html(t.THERMOSTAT+"<label>ÂºC</label>"),0==t.CentralaOn?$("#heaton_icon").addClass("invisible"):$("#heaton_icon").removeClass("invisible"),a=checkValueForBlink(t.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+a+'">'+t.CALOR1_VCC+"mV</div>"),a=checkValueForBlink(t.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+a+'">'+t.CALOR2_VCC+"mV</div>"),a=checkValueForBlink(t.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+a+'">'+t.CALOR3_VCC+"mV</div>"),a=checkValueForBlink(t.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+a+'">'+t.CALOR4_VCC+"mV</div>"),a=checkValueForBlink(t.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+a+'">'+t.CALOR5_VCC+"mV</div>"),a=checkValueForBlink(t.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+a+'">'+t.CALOR6_VCC+"mV</div>"),$("#CALOR1_CUR_STATE").html(decodeCalorMode(t.CALOR1_CUR_STATE)),$("#CALOR2_CUR_STATE").html(decodeCalorMode(t.CALOR2_CUR_STATE)),$("#CALOR3_CUR_STATE").html(decodeCalorMode(t.CALOR3_CUR_STATE)),$("#CALOR4_CUR_STATE").html(decodeCalorMode(t.CALOR4_CUR_STATE)),$("#CALOR5_CUR_STATE").html(decodeCalorMode(t.CALOR5_CUR_STATE)),$("#CALOR6_CUR_STATE").html(decodeCalorMode(t.CALOR6_CUR_STATE)),$("#CALOR1_SET_STATE").html(decodeCalorMode(t.CALOR1_SET_STATE)),$("#CALOR2_SET_STATE").html(decodeCalorMode(t.CALOR2_SET_STATE)),$("#CALOR3_SET_STATE").html(decodeCalorMode(t.CALOR3_SET_STATE)),$("#CALOR4_SET_STATE").html(decodeCalorMode(t.CALOR4_SET_STATE)),$("#CALOR5_SET_STATE").html(decodeCalorMode(t.CALOR5_SET_STATE)),$("#CALOR6_SET_STATE").html(decodeCalorMode(t.CALOR6_SET_STATE)),$("#lbl_umid_exterior").html(t.HUMIDITY_EXT+"<label>%</label>"),$("#lbl_umid_interior").html(t.HOL_HUMIDITY+"<label>%</label>"),$("#lbl_jal_raw").html(t.jalAutoModeRun+"<label>lx</label>"),$("#lbl_jalmode").html(decodeJalModeNow(t.jalModeNow)),$("#lbl_ldr_exterior").html(t.outdoorLDR+"<label>LX</label>"),$("#lbl_ldr_interior").html(t.dormitorLDR+"<label>LX</label>"),$("#lbl_battery").html(t.VOLTAGE_BATTERY+"<label>V</label>"),$("#lbl_12V").html(t.VOLTAGE_RAIL12+"<label>V</label>"),$("#lbl_mainsupply").html(t.VOLTAGE_MAIN+"<label>V</label>"),$("#totalHeatTime").html(t.totalHeatTime),$("#lastHeatTime").html(t.IncalzireSecondsLastState),$("#heatingState").html(t.CentralaOn?"ON":"OFF"),$("#idPlsWait").addClass("hidden")}}function decodeJalModeNow(e){switch(e){case 0:return"MANUAL";case 1:return"AUTO";case 2:return"USER LDR";default:return e}}function decodeCalorMode(e){switch(e){case 0:return"<div>NEDEFINIT</div>";case 1:return'<div class="green">DESCHIS</div>';case 2:return'<div class = "red">INCHIS</div>'}}function checkValueForBlink(e,t,a){var o=parseFloat(e);return o<t||o>a?"blink":""}function temp_resimtita(e,t,a){return parseFloat(e+t/100*.33*6.105*Math.exp(17.27*e/(237.7+e))-.7*a-4).toFixed(2)}function onVisibilityChange(){ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",function(){document.removeEventListener("visibilitychange",onVisibilityChange)}),$("#idPlsWait").removeClass("hidden")}),$("#btn_turbo").on("click",function(e){info.play(),setTimeout(function(){info.play()},3e3)});var AudioContextClass=window.AudioContext||window.webkitAudioContext,audioCtx=new AudioContextClass;function unlockAudio(){audioCtx&&"suspended"===audioCtx.state&&audioCtx.resume()}document.addEventListener("touchstart",unlockAudio,{once:!0}),document.addEventListener("click",unlockAudio,{once:!0}),setTimeout(function(){var e=document.createElement("script");e.src="https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/js/sound_library.js",e.onload=function(){console.log("sound_library OK")},document.head.appendChild(e)},3e3);