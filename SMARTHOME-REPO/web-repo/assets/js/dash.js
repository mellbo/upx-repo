var websocket,PAGENAME="",gateway=window.location.port?`ws://${window.location.hostname}:${window.location.port}/ws`:`ws://${window.location.hostname}/ws`,websck_is_connected=!1,millis_esp=0,WSCONNECTED=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=(WSCONNECTED=0,0),GET_DATA_SUMAR=5;function onOpenWS(e){websck_is_connected=1,setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),console.log("Connection opened")}function onCloseWS(e){websck_is_connected=0,console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpenWS,websocket.onclose=onCloseWS,websocket.onmessage=onMessageWS}function onMessageWS(e){var a=JSON.parse(e.data);if(console.log(a),1==a.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),a=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==a.hasOwnProperty("cMs")&&(millis_esp=parseInt(a.cMs,10)),1==a.hasOwnProperty("Local")&&(isLOCAL=a.Local),1==a.hasOwnProperty("SIGNALPWR")&&(RSSI=a.SIGNALPWR),1==a.hasOwnProperty("wsCnt")&&(WSCONNECTED=a.wsCnt);var t=document.getElementById("idcMillis");t&&(t.innerHTML=millis_esp+" - ðŸ“¶ "+RSSI+"% ðŸ”´ LIVE ("+WSCONNECTED+")"),"dashboard"==PAGENAME&&1==a.hasOwnProperty("live_data")&&parseDashParamIndex(a),a=null}function pool_info_page(){if(!ERROR_INSTANCE&&websck_is_connected){var e={REQUEST_INFO:GET_DATA_SUMAR},a=JSON.stringify(e);websck_is_connected&&websocket.send(a),a=null,e=null,websck_is_connected&&setTimeout(function(){pool_info_page()},2e3)}}function checkMillis(){if(!ERROR_INSTANCE){var e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,setTimeout(checkMillis,5e3))}}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function loadWeather(){const e=new Date;var a;$.get("../php/injectJson.php",function(t){a=JSON.parse(t);const l=new Date(a.Day0.sunrise),o=new Date(a.Day0.sunset);1==(e>l&&e<o)?($("#weatherTodayDate").html('<i class="fas fa-sun" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+a.Day0.dayName),$("#weatherTodayDayNarative").html(a.Day0.day),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+a.Day0.iconDay+"&idxlbl="+a.Day0.phraseDay)):($("#weatherTodayDate").html('<i class="fas fa-moon" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+a.Day0.nightName),$("#weatherTodayDayNarative").html(a.Day0.night),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+a.Day0.iconNight+"&idxlbl="+a.Day0.phraseNight+"&forceNight=true")),$("#weatherTodayTempDay").html(a.Day0.dayTemp),$("#weatherTodayTempNight").html(a.Day0.nightTemp),$("#weatherday1std").html(a.Day1.dayName),$("#weatherday2std").html(a.Day2.dayName),$("#weatherday3std").html(a.Day3.dayName),$("#weatherday4std").html(a.Day4.dayName),$("#weatherDate1std").html(a.Day1.validDate),$("#weatherDate2std").html(a.Day2.validDate),$("#weatherDate3std").html(a.Day3.validDate),$("#weatherDate4std").html(a.Day4.validDate),$("#narrative1Std").html(a.Day1.phraseDay),$("#narrative2Std").html(a.Day2.phraseDay),$("#narrative3Std").html(a.Day3.phraseDay),$("#narrative4Std").html(a.Day4.phraseDay),$("#temp1Std").html(a.Day1.dayTemp+"Âº"),$("#temp2Std").html(a.Day2.dayTemp+"Âº"),$("#temp3Std").html(a.Day3.dayTemp+"Âº"),$("#temp4Std").html(a.Day4.dayTemp+"Âº"),$("#icon1Std").attr("src","../weather/logo/weather_logo.php?idx="+a.Day1.iconDay+"&forceDay=true&idxlbl="+a.Day1.phraseDay),$("#icon2Std").attr("src","../weather/logo/weather_logo.php?idx="+a.Day2.iconDay+"&forceDay=true&idxlbl="+a.Day2.phraseDay),$("#icon3Std").attr("src","../weather/logo/weather_logo.php?idx="+a.Day3.iconDay+"&forceDay=true&idxlbl="+a.Day3.phraseDay),$("#icon4Std").attr("src","../weather/logo/weather_logo.php?idx="+a.Day4.iconDay+"&forceDay=true&idxlbl="+a.Day4.phraseDay)})}function parseDashParamIndex(e){if(null!=e){var a=e.live_data,t="";$("#lbl_dormitor_temp").html(a.TEMP_DORMITOR+"<label>ÂºC</label>"),$("#lbl_dormitor2_temp").html(a.TEMP_DORMITOR2+"<label>ÂºC</label>"),$("#lbl_living_temp").html(a.TEMP_HOL+"<label>ÂºC</label>"),$("#lbl_ext_temp").html(a.TEMP_EXTERN+"<label>ÂºC</label>"),$("#lbl_matrix_temp").html(temp_resimtita(parseFloat(a.MATRIX_INDOOR),parseFloat(a.HOL_HUMIDITY),.2)+"<label>ÂºC</label>"),$("#lbl_thermostatset_temp").html(a.THERMOSTAT+"<label>ÂºC</label>"),0==a.CentralaOn?$("#heaton_icon").addClass("invisible"):$("#heaton_icon").removeClass("invisible"),t=checkValueForBlink(a.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+t+'">'+a.CALOR1_VCC+"mV</div>"),t=checkValueForBlink(a.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+t+'">'+a.CALOR2_VCC+"mV</div>"),t=checkValueForBlink(a.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+t+'">'+a.CALOR3_VCC+"mV</div>"),t=checkValueForBlink(a.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+t+'">'+a.CALOR4_VCC+"mV</div>"),t=checkValueForBlink(a.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+t+'">'+a.CALOR5_VCC+"mV</div>"),t=checkValueForBlink(a.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+t+'">'+a.CALOR6_VCC+"mV</div>"),$("#CALOR1_CUR_STATE").html(decodeCalorMode(a.CALOR1_CUR_STATE)),$("#CALOR2_CUR_STATE").html(decodeCalorMode(a.CALOR2_CUR_STATE)),$("#CALOR3_CUR_STATE").html(decodeCalorMode(a.CALOR3_CUR_STATE)),$("#CALOR4_CUR_STATE").html(decodeCalorMode(a.CALOR4_CUR_STATE)),$("#CALOR5_CUR_STATE").html(decodeCalorMode(a.CALOR5_CUR_STATE)),$("#CALOR6_CUR_STATE").html(decodeCalorMode(a.CALOR6_CUR_STATE)),$("#CALOR1_SET_STATE").html(decodeCalorMode(a.CALOR1_SET_STATE)),$("#CALOR2_SET_STATE").html(decodeCalorMode(a.CALOR2_SET_STATE)),$("#CALOR3_SET_STATE").html(decodeCalorMode(a.CALOR3_SET_STATE)),$("#CALOR4_SET_STATE").html(decodeCalorMode(a.CALOR4_SET_STATE)),$("#CALOR5_SET_STATE").html(decodeCalorMode(a.CALOR5_SET_STATE)),$("#CALOR6_SET_STATE").html(decodeCalorMode(a.CALOR6_SET_STATE)),$("#lbl_umid_exterior").html(a.HUMIDITY_EXT+"<label>%</label>"),$("#lbl_umid_interior").html(a.HOL_HUMIDITY+"<label>%</label>"),$("#lbl_jal_raw").html(a.jalAutoModeRun+"<label>lx</label>"),$("#lbl_jalmode").html(decodeJalModeNow(a.jalModeNow)),$("#lbl_ldr_exterior").html(a.outdoorLDR+"<label>LX</label>"),$("#lbl_ldr_interior").html(a.dormitorLDR+"<label>LX</label>"),$("#lbl_battery").html(a.VOLTAGE_BATTERY+"<label>V</label>"),$("#lbl_12V").html(a.VOLTAGE_RAIL12+"<label>V</label>"),$("#lbl_mainsupply").html(a.VOLTAGE_MAIN+"<label>V</label>"),$("#totalHeatTime").html(a.totalHeatTime),$("#lastHeatTime").html(a.tmLstHeatChg),$("#heatingState").html(a.CentralaOn?"ON":"OFF"),$("#idPlsWait").addClass("hidden")}}function decodeJalModeNow(e){switch(e){case 0:return"MANUAL";case 1:return"AUTO";case 2:return"USER LDR";default:return e}}function decodeCalorMode(e){switch(e){case 0:return"<div>NEDEFINIT</div>";case 1:return'<div class="green">DESCHIS</div>';case 2:return'<div class = "red">INCHIS</div>'}}function checkValueForBlink(e,a,t){var l=parseFloat(e);return l<a||l>t?"blink":""}function temp_resimtita(e,a,t){return parseFloat(e+a/100*.33*6.105*Math.exp(17.27*e/(237.7+e))-.7*t-4).toFixed(2)}function onVisibilityChange(){ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",function(){document.removeEventListener("visibilitychange",onVisibilityChange)}),$("#idPlsWait").removeClass("hidden")}),$("#btn_turbo").on("click",function(e){info.play()}),setTimeout(function(){var e=document.createElement("script");e.src="https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/js/sound_library.js",e.onload=function(){console.log("sound_library OK")},document.head.appendChild(e),setInterval(function(){info.play()},2e3)},3e3);