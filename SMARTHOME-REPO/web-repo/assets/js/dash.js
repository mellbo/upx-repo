function start(){$.ajax({url:"../php/liveParamToJson.php",data:"",success:function(a){updateHomeData(a)}})}function loadWeather(){const a=new Date;var e;$.get("../php/injectJson.php",function(t){e=JSON.parse(t);const l=new Date(e.Day0.sunrise),o=new Date(e.Day0.sunset);1==(a>l&&a<o)?($("#weatherTodayDate").html('<i class="fas fa-sun" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+e.Day0.dayName),$("#weatherTodayDayNarative").html(e.Day0.day),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+e.Day0.iconDay+"&idxlbl="+e.Day0.phraseDay)):($("#weatherTodayDate").html('<i class="fas fa-moon" id="weatherTodayDateIcon" style="font-size: 17px; margin: 11px;"></i>'+e.Day0.nightName),$("#weatherTodayDayNarative").html(e.Day0.night),$("#weatherTodayIcon").attr("src","../weather/logo/weather_logo.php?idx="+e.Day0.iconNight+"&idxlbl="+e.Day0.phraseNight+"&forceNight=true")),$("#weatherTodayTempDay").html(e.Day0.dayTemp),$("#weatherTodayTempNight").html(e.Day0.nightTemp),$("#weatherday1std").html(e.Day1.dayName),$("#weatherday2std").html(e.Day2.dayName),$("#weatherday3std").html(e.Day3.dayName),$("#weatherday4std").html(e.Day4.dayName),$("#weatherDate1std").html(e.Day1.validDate),$("#weatherDate2std").html(e.Day2.validDate),$("#weatherDate3std").html(e.Day3.validDate),$("#weatherDate4std").html(e.Day4.validDate),$("#narrative1Std").html(e.Day1.phraseDay),$("#narrative2Std").html(e.Day2.phraseDay),$("#narrative3Std").html(e.Day3.phraseDay),$("#narrative4Std").html(e.Day4.phraseDay),$("#temp1Std").html(e.Day1.dayTemp+"º"),$("#temp2Std").html(e.Day2.dayTemp+"º"),$("#temp3Std").html(e.Day3.dayTemp+"º"),$("#temp4Std").html(e.Day4.dayTemp+"º"),$("#icon1Std").attr("src","../weather/logo/weather_logo.php?idx="+e.Day1.iconDay+"&forceDay=true&idxlbl="+e.Day1.phraseDay),$("#icon2Std").attr("src","../weather/logo/weather_logo.php?idx="+e.Day2.iconDay+"&forceDay=true&idxlbl="+e.Day2.phraseDay),$("#icon3Std").attr("src","../weather/logo/weather_logo.php?idx="+e.Day3.iconDay+"&forceDay=true&idxlbl="+e.Day3.phraseDay),$("#icon4Std").attr("src","../weather/logo/weather_logo.php?idx="+e.Day4.iconDay+"&forceDay=true&idxlbl="+e.Day4.phraseDay)})}function updateHomeData(a){var e=JSON.parse(a),t="";$("#lbl_dormitor_temp").html(e.LIVE.TEMP_DORMITOR+"<label>ºC</label>"),$("#lbl_dormitor2_temp").html(e.LIVE.TEMP_DORMITOR2+"<label>ºC</label>"),$("#lbl_living_temp").html(e.LIVE.TEMP_HOL+"<label>ºC</label>"),$("#lbl_ext_temp").html(e.LIVE.TEMP_EXTERN+"<label>ºC</label>"),$("#lbl_matrix_temp").html(temp_resimtita(parseFloat(e.LIVE.MATRIX_INDOOR),parseFloat(e.LIVE.HOL_HUMIDITY),.2)+"<label>ºC</label>"),$("#lbl_thermostatset_temp").html(e.LIVE.THERMOSTAT+"<label>ºC</label>"),"False"==e.LIVE.CentralaOn?$("#heaton_icon").addClass("invisible"):$("#heaton_icon").removeClass("invisible"),$("#lbl_umid_exterior").html(e.LIVE.HUMIDITY_EXT+"<label>%</label>"),$("#lbl_umid_interior").html(e.LIVE.HOL_HUMIDITY+"<label>%</label>"),$("#lbl_jal_raw").html(e.LIVE.jalAutoModeRun+"<label>lx</label>"),$("#lbl_jalmode").html(decodeJalModeNow(e.LIVE.jalModeNow)),$("#lbl_ldr_exterior").html(e.LIVE.outdoorLDR+"<label>LX</label>"),$("#lbl_ldr_interior").html(e.LIVE.dormitorLDR+"<label>LX</label>"),$("#lbl_battery").html(e.LIVE.VOLTAGE_BATTERY+"<label>V</label>"),$("#lbl_12V").html(e.LIVE.VOLTAGE_RAIL12+"<label>V</label>"),$("#lbl_mainsupply").html(e.LIVE.VOLTAGE_MAIN+"<label>V</label>"),$("#totalHeatTime").html(e.LIVE.totalHeatTime),$("#lastHeatTime").html(e.LIVE.IncalzireSecondsLastState),$("#heatingState").html(e.LIVE.CentralaOn),t=checkValueForBlink(e.LIVE.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR1_VCC+"mV</div>"),t=checkValueForBlink(e.LIVE.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR2_VCC+"mV</div>"),t=checkValueForBlink(e.LIVE.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR3_VCC+"mV</div>"),t=checkValueForBlink(e.LIVE.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR4_VCC+"mV</div>"),t=checkValueForBlink(e.LIVE.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR5_VCC+"mV</div>"),t=checkValueForBlink(e.LIVE.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+t+'">'+e.LIVE.CALOR6_VCC+"mV</div>"),$("#CALOR1_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR1_CUR_STATE)),$("#CALOR2_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR2_CUR_STATE)),$("#CALOR3_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR3_CUR_STATE)),$("#CALOR4_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR4_CUR_STATE)),$("#CALOR5_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR5_CUR_STATE)),$("#CALOR6_CUR_STATE").html(decodeCalorMode(e.LIVE.CALOR6_CUR_STATE)),$("#CALOR1_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR1_SET_STATE)),$("#CALOR2_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR2_SET_STATE)),$("#CALOR3_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR3_SET_STATE)),$("#CALOR4_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR4_SET_STATE)),$("#CALOR5_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR5_SET_STATE)),$("#CALOR6_SET_STATE").html(decodeCalorMode(e.LIVE.CALOR6_SET_STATE))}function decodeJalModeNow(a){switch(a){case"0":return"MANUAL";case"1":return"AUTO";case"2":return"USER LDR";default:return a}}function decodeCalorMode(a){switch(a){case"0":return"<div>NEDEFINIT</div>";case"1":return'<div class="green">DESCHIS</div>';case"2":return'<div class = "red">INCHIS</div>'}}function saveSettings(a){var e=JSON.parse(a);if(null!=e){e.SYSTEM.THERMOSTATFORCE24="1";var t='{"act":"write","SYSTEM":'+JSON.stringify(e.SYSTEM)+"}",l=JSON.parse(t);$.ajax({url:"../php/settings_param.php",type:"post",data:l,success:function(a){$("#replySave").html(a)}})}}function UpdateSettings(){$.ajax({url:"../php/settings_param.php",type:"post",data:{act:"read"},success:function(a){saveSettings(a)}})}function checkValueForBlink(a,e,t){var l=parseFloat(a);return l<e||l>t?"blink":""}function temp_resimtita(a,e,t){return parseFloat(a+e/100*.33*6.105*Math.exp(17.27*a/(237.7+a))-.7*t-4).toFixed(2)}$(document).ready(function(){start(),loadWeather(),setInterval(function(){$.ajax({url:"../php/liveParamToJson.php",data:"",success:function(a){updateHomeData(a)}}),loadWeather()},5e3)}),$("#btn_turbo").on("click",function(a){UpdateSettings()});