var websocket,PAGENAME="",AddNewTemperatureInMonth="",PREFERED_LIGHT_DORMITOR=0,LIVE_DORMITOR_LDR=0,idleTime=0,THERMOSTATLAST="",timers=[],intervals=[],gateway=window.location.port?`ws://${window.location.hostname}:${window.location.port}/ws`:`ws://${window.location.hostname}/ws`,websck_is_connected=!1,millis_esp=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=0,paginaVizibila=!0,USR_MAC="00:00:00:00:00:00",FIRST_INIT_LOGS=!0,PAUSE_POOL_INFO=!1;const LIVE_DATA_TYPE=1,GET_DATA_TYPE=2,GET_DATA_QUICK=3,GET_DATA_LOGS=4,ONLY_PING=254;function inject_function_settings(){console.log("loading action and function settings"),window.initTimePicker=function(){const e=Array.from({length:24},(e,n)=>n),n=Array.from({length:60},(e,n)=>n);window.hoursWheel=new WheelPicker("hoursWheel",e),window.minutesWheel=new WheelPicker("minutesWheel",n),window.horizontalWheel=new HorizontalWheelPicker({containerId:"H-wheel-container",min:12,max:38,step:.1,initialValue:12})},window.openTimePicker=function(e){const n=new Date;window.hoursWheel.setSelected(n.getHours()),window.minutesWheel.setSelected(n.getMinutes()),window.horizontalWheel&&void 0!==e&&horizontalWheel.setToValue(e-.3),$("#timePickerModal").modal("show")},window.setSlideValue=function(e,n,t){null!=e&&$(e).slider("setValue",t,!0),null!=n&&$(n).text($(e).val())},window.parseQuickSys=function(e){if(null==e)return;console.log(e);const n=e.QUICKSYSTEM;LIVE_DORMITOR_LDR=n.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR);let t=0;1==n.hasOwnProperty("en_quick")&&(t=1),t&&(console.log("Settings UPD"),$("#climatizareOption").val(n.CLIMA_MODE),$("#set_forceMainDoorOpen").prop("checked",n.forceMainDoorOpen),$("#force24Thermo").val(n.THERMOSTATFORCE24),info.play());let o=0;if(n.hasOwnProperty("ThermLST")&&(o=1),o){console.log("Thermostat UPD");const e=document.getElementById("selCalendarItem");e.innerHTML="";const t=n.ThermLST;t&&Array.isArray(t)&&t.forEach((n,t)=>{if(3===n.length){const[o,i,l]=n,s=document.createElement("option");s.value=t,s.text=`Ora: ${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")} Temperatura: ${l.toFixed(2)}`,e.appendChild(s)}}),info.play()}},window.parseSettings=function(e){if(null==e)return;console.log(e);const n=e.SYSTEM;$("#set_THERMOSTAT_OUTSIDE_ENABLE").prop("checked",n.THERMOSTAT_OUTSIDE_ENABLE),$("#set_forceMainDoorOpen").prop("checked",n.forceMainDoorOpen),$("#set_AlowLightOFF").prop("checked",n.AlowLightOFF),$("#setKEY110_ENABLE").prop("checked",n.KEY110ENABLE),$("#setKEY120_ENABLE").prop("checked",n.KEY120ENABLE),$("#setKEY130_ENABLE").prop("checked",n.KEY130ENABLE),$("#setKEY255_ENABLE").prop("checked",n.KEY255ENABLE),$("#SetKEY110NAME").val(n.KEY110NAME),$("#SetKEY120NAME").val(n.KEY120NAME),$("#SetKEY130NAME").val(n.KEY130NAME),$("#SetKEY255NAME").val(n.KEY255NAME),$("#setLivoloTestID").val(n.LivoloTestID),$("#idMaxLogCnt").val(n.MaxLogCnt),setSlideValue("#set_CENTRALA_ON_HISTERIZIS","#param1Value",n.CENTRALA_ON_HISTERIZIS),setSlideValue("#set_TEMP_INDOOR_CALCULATION_METHOD","#param2Value",n.TEMP_INDOOR_CALCULATION_METHOD),setSlideValue("#set_jalAutoModeRun","#param3Value",n.jalAutoModeRun),setSlideValue("#set_LowLightPoint","#param4Value",n.LowLightPoint),setSlideValue("#set_jaluzHisterizis","#param5Value",n.jaluzHisterizis),setSlideValue("#set_FunTemperatureTrigger","#param6Value",n.FunTemperatureTrigger),PREFERED_LIGHT_DORMITOR=n.PREFERED_LIGHT_DORMITOR,THERMOSTATLAST=n.THERMOSTAT_LAST,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR),$("#beepModeID").val(n.UserBeepMode),(isLOCAL=e.isLOCAL)?$("#set_forceMainDoorOpen").prop("disabled",!1):($("#set_forceMainDoorOpen").prop("disabled",!0),$("#set_forceMainDoorOpen").removeClass("btn-success"),$("#set_forceMainDoorOpen").addClass("btn-danger")),$("#climatizareOption").val(n.CLIMA_MODE),$("#force24Thermo").val(n.THERMOSTATFORCE24),$("#smartWelcomeEnable").prop("checked",n.smartWelcomeEnable),$("#smartWelcomeAutoSetup").prop("checked",n.smartWelcomeAutoSetup),$("#welcome_Luni").val(n.Welcome_Time.day1),$("#welcome_Marti").val(n.Welcome_Time.day2),$("#welcome_Miercuri").val(n.Welcome_Time.day3),$("#welcome_Joi").val(n.Welcome_Time.day4),$("#welcome_Vineri").val(n.Welcome_Time.day5),$("#welcome_Sambata").val(n.Welcome_Time.day6),$("#welcome_Duminica").val(n.Welcome_Time.day7),$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1);const t=document.getElementById("selCalendarItem");t.innerHTML="";const o=n.ThermLST;o&&Array.isArray(o)&&o.forEach((e,n)=>{if(3===e.length){const[o,i,l]=e,s=document.createElement("option");s.value=n,s.text=`Ora: ${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")} Temperatura: ${l.toFixed(2)}`,t.appendChild(s)}}),$("#idPlsWait").addClass("hidden")},window.restoreESP=function(){if(confirm("Do you really want to clear data on system\nand Restore to Default ?")){let e={RESET:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,alert("The system is resetting and restarting, approximately 1 minute.\nAfter restoration, you may need to enter SAFEMODE\nto input the configuration data for Internet WIFI.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog after you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)}},window.rebootESP=function(){let e={RESTART:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,alert("The system is restarting, 30 seconds.\nRefresh the page after the time has elapsed."),setTimeout(function(){location.reload()},3e3)},window.ClearData=function(){if(confirm("Do you really want to clear data on system ?")){let e={CLEAR_DATA:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,alert("System data has been cleared. Setup again your system.\nSystem rebooting. Wait ~1 min for refresh."),setTimeout(function(){location.reload()},3e3)}},window.rebootInSafeMode=function(){if(confirm("Do you really want to reboot in SAFEMODE ?")){ERROR_INSTANCE=1;let e={SAFEMODE:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,alert("The system is restarting and will run in AP-SAFEMODE.\nLook for the WIFI SSID 'UPX-SMARTHOME' and connect to it.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog AFTER you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)}},window.dtOutInfo=function(e){document.getElementById("dtOut").innerHTML="<div style='width:400px;' class='alert alert-danger' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>×</span></button><span>"+e+"</span></div>"},$("#set_THERMOSTAT_OUTSIDE_ENABLE").on("change",function(e){let n={THERMOSTAT_OUTSIDE_ENABLE:$("#set_THERMOSTAT_OUTSIDE_ENABLE").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#apply_CENTRALA_ON_HISTERIZIS").on("click",function(){let e={CENTRALA_ON_HISTERIZIS:parseFloat($("#set_CENTRALA_ON_HISTERIZIS").val())},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_CENTRALA_ON_HISTERIZIS").addClass("hidden")}),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").on("click",function(){let e={TEMP_INDOOR_CALCULATION_METHOD:parseInt($("#set_TEMP_INDOOR_CALCULATION_METHOD").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_TEMP_INDOOR_CALCULATION_METHOD").addClass("hidden")}),$("#apply_jalAutoModeRun").on("click",function(){let e={jalAutoModeRun:parseInt($("#set_jalAutoModeRun").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_jalAutoModeRun").addClass("hidden")}),$("#save_welcome_setup").on("click",function(){let e=[];e.push($("#welcome_Luni").val()),e.push($("#welcome_Marti").val()),e.push($("#welcome_Miercuri").val()),e.push($("#welcome_Joi").val()),e.push($("#welcome_Vineri").val()),e.push($("#welcome_Sambata").val()),e.push($("#welcome_Duminica").val());let n={save_welcome_setup:1,smartWelcomeEnable:$("#smartWelcomeEnable").is(":checked"),smartWelcomeAutoSetup:$("#smartWelcomeAutoSetup").is(":checked"),smartWelcomeTimes:e},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null,$("#smartWelcomeWindow").removeClass("in")}),$("#preff_ldr").on("click",function(){PREFERED_LIGHT_DORMITOR=LIVE_DORMITOR_LDR,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR);let e={PREFERED_LIGHT_DORMITOR:parseInt(PREFERED_LIGHT_DORMITOR,10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null}),$("#apply_LowLightPoint").on("click",function(){let e={LowLightPoint:parseInt($("#set_LowLightPoint").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_LowLightPoint").addClass("hidden")}),$("#apply_jaluzHisterizis").on("click",function(){let e={jaluzHisterizis:parseInt($("#set_jaluzHisterizis").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_jaluzHisterizis").addClass("hidden")}),$("#climatizareOption").on("change",function(e){let n=parseInt($(this).val(),10),t={CLIMA_MODE:parseInt(n,10)},o=JSON.stringify(t);websck_is_connected&&websocket.send(o),o=null,t=null}),$("#beepModeID").on("change",function(e){let n={UserBeepMode:parseInt($(this).val(),10)},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#set_forceMainDoorOpen").on("click",function(e){let n={forceMainDoorOpen:!0},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null,$("#set_forceMainDoorOpen").prop("disabled",!0),$("#set_forceMainDoorOpen").removeClass("btn-success"),$("#set_forceMainDoorOpen").addClass("btn-danger"),timers.push(setTimeout(function(){let e={forceMainDoorOpen:!1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#set_forceMainDoorOpen").prop("disabled",!1),$("#set_forceMainDoorOpen").removeClass("btn-danger"),$("#set_forceMainDoorOpen").addClass("btn-success")},3e3))}),$("#set_AlowLightOFF").on("change",function(e){let n={AlowLightOFF:$("#set_AlowLightOFF").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#apply_FunTemperatureTrigger").on("click",function(){let e={FunTemperatureTrigger:parseFloat($("#set_FunTemperatureTrigger").val())},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_FunTemperatureTrigger").addClass("hidden")}),$("#apply_LivoloTestID").on("click",function(){let e={LivoloTestID:parseInt($("#setLivoloTestID").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_LivoloTestID").addClass("hidden")}),$("#apply_MaxLogCnt").on("click",function(){let e={MaxLogCnt:parseInt($("#idMaxLogCnt").val(),10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_MaxLogCnt").addClass("hidden")}),$("#force24Thermo").on("change",function(e){let n={THERMOSTATFORCE24:parseInt($(this).val(),10)},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#setKEY110_ENABLE").on("change",function(e){let n={KEY110ENABLE:$("#setKEY110_ENABLE").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#setKEY120_ENABLE").on("change",function(e){let n={KEY120ENABLE:$("#setKEY120_ENABLE").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#setKEY130_ENABLE").on("change",function(e){let n={KEY130ENABLE:$("#setKEY130_ENABLE").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#setKEY255_ENABLE").on("change",function(e){let n={KEY255ENABLE:$("#setKEY255_ENABLE").is(":checked")},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null}),$("#apply_KEY110NAME").on("click",function(){let e={KEY110_NAME:$("#SetKEY110NAME").val()},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_KEY110NAME").addClass("hidden")}),$("#apply_KEY120NAME").on("click",function(){let e={KEY120_NAME:$("#SetKEY120NAME").val()},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_KEY120NAME").addClass("hidden")}),$("#apply_KEY130NAME").on("click",function(){let e={KEY130_NAME:$("#SetKEY130NAME").val()},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_KEY130NAME").addClass("hidden")}),$("#apply_KEY255NAME").on("click",function(){let e={KEY255_NAME:$("#SetKEY255NAME").val()},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,$("#apply_KEY255NAME").addClass("hidden")}),$("#timePickerOkBtn").on("click",function(e){let n=window.hoursWheel.getSelected().toString().padStart(2,"0"),t=window.minutesWheel.getSelected().toString().padStart(2,"0"),o=window.horizontalWheel.getSelectedValue().toString();if(confirm("Introduceti temperatura "+o+" pentru ora "+(n+":"+t)+" ?")){let e={NewThermostatData:1,therm_hour:parseInt(n,10),therm_min:parseInt(t,10),therm_temp:parseFloat(parseFloat(o).toFixed(2))},i=JSON.stringify(e);websck_is_connected&&websocket.send(i),i=null,e=null,$("#timePickerModal").modal("hide")}}),$("#reload_callendar").on("click",function(e){PAUSE_POOL_INFO=!0;let n={REQUEST_INFO:2},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null,setTimeout(function(){PAUSE_POOL_INFO=!1},1e3),dtOutInfo("Data <b>reload</b> in Page..")}),$("#del_itm_calendar").on("click",function(e){let n=document.getElementById("selCalendarItem"),t=n.value,o=n.options[n.selectedIndex].text;if(console.log("DEL:",t,o),confirm("Stergeti <"+o+"> din sistem ?")){let e={CAL_DEL_ITEM:parseInt(t,10)},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,dtOutInfo("Delete pos <b>"+t+"</b> in Calendar")}}),$("#reset_cal_month").on("click",function(){if(confirm("Resetati aceasta luna in Calendar ?")){let e={RST_CAL_CURMONTH:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,dtOutInfo("RST curent month in Calendar")}}),$("#reset_cal_all").on("click",function(){if(confirm("Resetati aceasta luna in Calendar ?")){let e={RST_CAL_ALL:1},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,dtOutInfo("RST All month in Calendar<br>System reboot now !")}}),$("#SetKEY110NAME").on("input",function(e){$("#apply_KEY110NAME").removeClass("hidden")}),$("#SetKEY120NAME").on("input",function(e){$("#apply_KEY120NAME").removeClass("hidden")}),$("#SetKEY130NAME").on("input",function(e){$("#apply_KEY130NAME").removeClass("hidden")}),$("#SetKEY255NAME").on("input",function(e){$("#apply_KEY255NAME").removeClass("hidden")}),$("#set_CENTRALA_ON_HISTERIZIS").slider({id:"ex1Slider",min:.2,max:5,step:.1,value:.2,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_CENTRALA_ON_HISTERIZIS").on("change",function(e){$("#param1Value").text($(this).val()),$("#apply_CENTRALA_ON_HISTERIZIS").removeClass("hidden")}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").slider({id:"ex1Slider",min:0,max:5,step:1,value:1,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").on("change",function(e){$("#param2Value").text($(this).val()),$("#metodaCalculBtn").addClass("in"),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").removeClass("hidden")}),$("#set_jalAutoModeRun").slider({id:"ex1Slider",min:0,max:900,step:1,value:0,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jalAutoModeRun").on("change",function(e){$("#param3Value").text($(this).val()),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MROFF").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",0),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRUP").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",1),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRDOWN").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",2),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRAUTOMAT").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",3),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#set_LowLightPoint").slider({id:"ex1Slider",min:0,max:500,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_LowLightPoint").on("change",function(e){$("#param4Value").text($(this).val()),$("#apply_LowLightPoint").removeClass("hidden")}),$("#set_jaluzHisterizis").slider({id:"ex1Slider",min:0,max:200,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jaluzHisterizis").on("change",function(e){$("#param5Value").text($(this).val()),$("#apply_jaluzHisterizis").removeClass("hidden")}),$("#set_FunTemperatureTrigger").slider({id:"ex1Slider",min:20,max:50,step:.25,value:24,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_FunTemperatureTrigger").on("change",function(e){$("#param6Value").text($(this).val()),$("#apply_FunTemperatureTrigger").removeClass("hidden")}),$("#setLivoloTestID").on("change",function(e){$("#apply_LivoloTestID").removeClass("hidden")}),$("#idMaxLogCnt").on("change",function(e){$("#apply_MaxLogCnt").removeClass("hidden")}),$("#adaugaInThermostat").on("click",function(e){openTimePicker(21.8)}),$("#save").on("click",function(){}),$("#smartWelcomeAutoSetup").on("change",function(e){$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1)}),document.getElementById("idRestoreESP").addEventListener("click",restoreESP),document.getElementById("idRebootESP").addEventListener("click",rebootESP),document.getElementById("idClearData").addEventListener("click",ClearData),document.getElementById("idBtnSafeMod").addEventListener("click",rebootInSafeMode),initTimePicker()}function inject_function_index(){console.log("loading action and function index"),window.checkValueForBlink=function(e,n,t){var o=parseFloat(e);return o<n||o>t?"blink":""},window.temp_resimtita=function(e,n,t){return parseFloat(e+n/100*.33*6.105*Math.exp(17.27*e/(237.7+e))-.7*t-4).toFixed(2)},window.decodeJalModeNow=function(e){switch(e){case 0:return"MANUAL";case 1:return"AUTO";case 2:return"USER LDR";default:return e}},window.processCalorPos=function(e,n,t){var o="";return"1"==n&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #ff5c38;"></i>'),"2"==n&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #00fff0;"></i>'),n!=t&&(o='<i id="'+e+'" class="icon ion-ios-flame blink" style="margin: 0px 5px 0px;color: #ffcc1e;"></i>'),"0"==n&&(o='<i id="'+e+'" class="icon ion-android-warning" style="margin: 0px 3px 0px;color: #ffffff;"></i>'),o},window.parseLiveParamIndex=function(e){console.log(e);const n=e.live_data;var t,o,i,l,s,a,c,r,d,E,u,_,p="";o=n.CALOR1_SET_STATE,l=n.CALOR2_SET_STATE,a=n.CALOR3_SET_STATE,r=n.CALOR4_SET_STATE,E=n.CALOR5_SET_STATE,_=n.CALOR6_SET_STATE,t=n.CALOR1_CUR_STATE,i=n.CALOR2_CUR_STATE,s=n.CALOR3_CUR_STATE,c=n.CALOR4_CUR_STATE,d=n.CALOR5_CUR_STATE,u=n.CALOR6_CUR_STATE,p=checkValueForBlink(n.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+p+'">'+n.CALOR1_VCC+"mV</div>"),p=checkValueForBlink(n.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+p+'">'+n.CALOR2_VCC+"mV</div>"),p=checkValueForBlink(n.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+p+'">'+n.CALOR3_VCC+"mV</div>"),p=checkValueForBlink(n.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+p+'">'+n.CALOR4_VCC+"mV</div>"),p=checkValueForBlink(n.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+p+'">'+n.CALOR5_VCC+"mV</div>"),p=checkValueForBlink(n.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+p+'">'+n.CALOR6_VCC+"mV</div>"),$("#THERMOSTAT").html(n.THERMOSTAT.toFixed(2)),$("#TEMP_BUCATARIE").html(n.TEMP_BUCATARIE.toFixed(2)),$("#TEMP_DORMITOR").html("<div>"+n.TEMP_DORMITOR.toFixed(2)+"&nbsp;&nbsp;"+processCalorPos("cal6",d,E)+"</div>"),p=checkValueForBlink(n.HUM_DORMITOR2,20,65),$("#TEMP_DORMITOR2").html('<div class="'+p+'">'+n.TEMP_DORMITOR2.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+n.HUM_DORMITOR2+"%&nbsp;&nbsp;"+processCalorPos("cal5",u,_)+"</div>"),p=checkValueForBlink(n.HOL_HUMIDITY,20,65),$("#TEMP_HOL").html('<div class="'+p+'">'+n.TEMP_HOL.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+n.HOL_HUMIDITY+"%&nbsp;&nbsp;"+processCalorPos("cal1",t,o)+processCalorPos("cal2",i,l)+processCalorPos("cal3",s,a)+processCalorPos("cal4",c,r)+"</div>"),$("#TEMP_EXTERN").html(n.TEMP_EXTERN.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+n.HUMIDITY_EXT+"%"),p=checkValueForBlink(n.VOLTAGE_BATTERY,12,13.9),$("#VOLTAGE_BATTERY").html('<div class="'+p+'">'+n.VOLTAGE_BATTERY.toFixed(2)+"</div>"),p=checkValueForBlink(n.VOLTAGE_RAIL12,11.8,12.5),$("#VOLTAGE_RAIL12").html('<div class="'+p+'">'+n.VOLTAGE_RAIL12.toFixed(2)+"</div>"),p=checkValueForBlink(n.VOLTAGE_MAIN,14.9,15.6),$("#VOLTAGE_MAIN").html('<div class="'+p+'">'+n.VOLTAGE_MAIN.toFixed(2)+"</div>"),$("#CentralaOn").html((n.CentralaOn?"DA":"NU")+" de "+n.IncalzireSecondsLastState),$("#ClimaON").html(n.ClimaOn?"DA":"NU"),$("#jalAutoModeRun").html(decodeJalAutoMode(n.jalAutoModeRun)),$("#LowLightPoint").html(n.LowLightPoint),$("#AlowLightOFF").html(n.AlowLightOFF?"DA":"NU"),$("#HomeIsAlone").html(n.HomeIsAlone?"DA":"NU"),$("#jaluzHisterizis").html(n.jaluzHisterizis),p=checkValueForBlink(n.KEY110BATTERY,2.75,3.3),$("#KEY110BATTERY").html('<div class="'+p+'">'+n.KEY110BATTERY+"</div>"),$("#KEY110LASTSEEN").html(n.KEY110LASTSEEN),$("#KEY110ENABLE").html(n.KEY110ENABLE?"DA":"NU"),$("#KEY110HOME").html((n.KEY110HOME?"DA":"NU")+", de "+n.KEY110LASTCHANGE),$("#KEY110NAME").html(n.KEY110NAME),p=checkValueForBlink(n.KEY120BATTERY,2.75,3.3),$("#KEY120BATTERY").html('<div class="'+p+'">'+n.KEY120BATTERY+"</div>"),$("#KEY120LASTSEEN").html(n.KEY120LASTSEEN),$("#KEY120ENABLE").html(n.KEY120ENABLE?"DA":"NU"),$("#KEY120HOME").html((n.KEY120HOME?"DA":"NU")+", de "+n.KEY120LASTCHANGE),$("#KEY120NAME").html(n.KEY120NAME),p=checkValueForBlink(n.KEY130BATTERY,2.75,3.3),$("#KEY130BATTERY").html('<div class="'+p+'">'+n.KEY130BATTERY+"</div>"),$("#KEY130LASTSEEN").html(n.KEY130LASTSEEN),$("#KEY130ENABLE").html(n.KEY130ENABLE?"DA":"NU"),$("#KEY130HOME").html((n.KEY130HOME?"DA":"NU")+", de "+n.KEY130LASTCHANGE),$("#KEY130NAME").html(n.KEY130NAME),p=checkValueForBlink(n.KEY255BATTERY,2.75,3.3),$("#KEY255BATTERY").html('<div class="'+p+'">'+n.KEY255BATTERY+"</div>"),$("#KEY255LASTSEEN").html(n.KEY255LASTSEEN),$("#KEY255ENABLE").html(n.KEY255ENABLE?"DA":"NU"),$("#KEY255HOME").html((n.KEY255HOME?"DA":"NU")+", de "+n.KEY255LASTCHANGE),$("#KEY255NAME").html(n.KEY255NAME),$("#TEMP_INDOOR_CALCULATION_METHOD").html(n.TEMP_INDOOR_CALCULATION_METHOD),$("#CENTRALA_ON_HISTERIZIS").html(n.CENTRALA_ON_HISTERIZIS.toFixed(2)),$("#THERMOSTAT_OUTSIDE_ENABLE").html(n.THERMOSTAT_OUTSIDE_ENABLE?"DA":"NU"),$("#TEMP_GATEWAY").html(n.TEMP_GATEWAY.toFixed(2)),$("#TEMP_MATRIX").html(temp_resimtita(parseFloat(n.MATRIX_INDOOR),parseFloat(n.HOL_HUMIDITY),.2)).toString(),$("#jalModeNow").html(decodeJalModeNow(n.jalModeNow)),LIVE_DORMITOR_LDR=n.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR),$("#outdoorLDR").html(n.outdoorLDR),$("#MATRIX_INDOOR").html(n.MATRIX_INDOOR),$("#jalAutoModeRunDSP").html(n.jalAutoModeRun),$("#updateTime").text(n.LocalTime),$("#idPlsWait").addClass("hidden")}}function inject_function_events(){console.log("loading action and function events"),window.parseErrorEvt=async function(e,n){let t;try{const e=await fetch("http://upx83.go.ro/upx-center/events/evt_translate.lst"),n=await e.text();t=new Function("return "+n)()}catch{return void console.log("Eroare la citire fisier")}function o(e,n,t=!1){switch(n){case"events_info":t?$("#idLogInfo").html(e):$("#idLogInfo").append("<br>"+e);break;case"events_warning":t?$("#idLogWarning").html(e):$("#idLogWarning").append("<br>"+e);break;case"events_error":t?$("#idLogError").html(e):$("#idLogError").append("<br>"+e);break;case"events_misc":t?$("#idLogMisc").html(e):$("#idLogMisc").append("<br>"+e);break;default:console.log("Err: type_events")}}function i(e){let n="";return e>=0&&(n=e>1?" :"+e.toString():" :"+(1===e?"True":"False")),n}function l(e,n,t){switch(n){case"events_info":switch(t){case 2:case 3:case 6:case 7:case 8:case 13:case 14:case 21:return": "+e.toString();case 9:switch(e){case 0:return": OPRITA";case 1:return": 21ºC";case 2:return": 22ºC";case 3:return": 23ºC";case 4:return": 24ºC";case 5:return": 24.5ºC";case 6:return": 25ºC";case 7:return": 25.5ºC";case 8:return": 26ºC";case 9:return": ENERGY SAViNG";case 10:return": Pornit 1 ora";case 11:return": AUTO HEATING"}break;case 10:switch(e){case 0:return": No Beep";case 1:return": System Beep";case 2:return": Warning Beep";case 3:return": All Beep"}break;case 4:return": "+decodeJalAutoMode(e);case 20:return": "+function(e){let n=e.toString();return 9!==n.length?"Err: număr invalid":`${n.substring(1,3)}:${n.substring(3,5)} ${(parseInt(n.substring(5,9))/100).toFixed(2)}ºC`}(e);default:return i(e)}break;case"events_warning":case"events_error":case"events_misc":return i(e);default:console.log("Err: decodeEventValue type_events")}}let s=[n];"ALL_EVENTS"==n&&(s=["events_info","events_warning","events_error","events_misc"]),s.forEach(i=>{const s=e[i];if(s?.length){for(let e=0;e<s.length;e++){lineRaw=s[e];const n=lineRaw.split(",");let a=n[0],c=1*n[1].trim(),r="";r=l(1*n[2].trim(),i,c).toString(),o(a+":"+t[i][c]+r,i,!!!e)}"ALL_EVENTS"!=n&&("events_info"==i&&$("#idLogInfo").append("<br>ℹ️ Reload -INFO- Done."),"events_warning"==i&&$("#idLogWarning").append("<br>ℹ️ Reload -WARN- Done."),"events_error"==i&&$("#idLogError").append("<br>ℹ️ Reload -ERROR- Done."),"events_misc"==i&&$("#idLogMisc").append("<br>ℹ️ Reload -MISC- Done."))}else console.log("No event in array")})},window.loadEvents=function(e="ALL_EVENTS"){$.ajax({url:"http://upx83.go.ro/upx-center/events/event_server.php",type:"post",dataType:"json",cache:!1,timeout:2e3,data:{get_events_content:e,user_mac:USR_MAC},success:function(n){"ERROR"==n[0]?console.log(n[0],n[1]):parseErrorEvt(n[2],e)},error:function(e){console.log(e.responseText)}})},$("#btnKeyInfo").on("click",function(){loadEvents("events_misc"),info.play()}),$("#btnLogInfo").on("click",function(){loadEvents("events_info")}),$("#btnLogWarning").on("click",function(){loadEvents("events_warning")}),$("#btnLogError").on("click",function(){loadEvents("events_error")})}function onOpen(e){websck_is_connected=1,"settings"==PAGENAME?(verificaVersiune(),getSettingsDataCmd()):setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),console.log("Connection opened")}function onClose(e){websck_is_connected=0,console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpen,websocket.onclose=onClose,websocket.onmessage=onMessage}function onMessage(e){let n=JSON.parse(e.data);if(1==n.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),n=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==n.hasOwnProperty("cMs")&&(millis_esp=parseInt(n.cMs,10)),1==n.hasOwnProperty("Local")&&(isLOCAL=n.Local),1==n.hasOwnProperty("SIGNALPWR")&&(RSSI=n.SIGNALPWR),1==n.hasOwnProperty("USR_MAC")&&(USR_MAC=n.USR_MAC);let t=document.getElementById("idcMillis");t&&(t.innerHTML=millis_esp+" - 📶 "+RSSI+"%"),"index"==PAGENAME&&1==n.hasOwnProperty("live_data")&&parseLiveParamIndex(n),"settings"==PAGENAME&&(1==n.hasOwnProperty("SYSTEM")&&parseSettings(n),1==n.hasOwnProperty("QUICKSYSTEM")&&parseQuickSys(n)),"logs"==PAGENAME&&"default"!=USR_MAC&&FIRST_INIT_LOGS&&(FIRST_INIT_LOGS=!1,timers.push(setTimeout(function(){loadEvents("ALL_EVENTS"),$("#idPlsWait").addClass("hidden")},500))),n=null}async function verificaVersiune(){let e="";const n=document.getElementById("idVersion");if(!n)return;e=n.innerHTML.trim();const t=await fetch("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/firmware/version"),o=await t.text(),i=Object.fromEntries(o.split("\n").map(e=>e.split("=").map(e=>e.trim())));if(console.log("Check VERSION.."),i.version!==e){console.log("Update available!");const e=document.getElementById("idNewFirmware");if(e){const n=document.getElementById("idNewFirmwareURL");n&&(n.href=i.url,e.classList.remove("hidden"))}}else console.log("No update available")}function onVisibilityChange(){paginaVizibila=!document.hidden,ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}function pool_info_page(){if(ERROR_INSTANCE||!websck_is_connected)return;if(PAUSE_POOL_INFO)return;let e=254;"index"==PAGENAME&&(e=1),"settings"==PAGENAME&&(e=3),"logs"==PAGENAME&&(e=4);let n={REQUEST_INFO:e},t=JSON.stringify(n);websck_is_connected&&websocket.send(t),t=null,n=null,websck_is_connected&&timers.push(setTimeout(function(){pool_info_page()},2e3))}function checkMillis(){if(ERROR_INSTANCE)return;let e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,timers.push(setTimeout(checkMillis,5e3)))}function timerIncrement(){(idleTime+=1)>30&&(idleTime=0,window.location.reload(!0)),idleTime>10?$("body").css({overflow:"hidden"}):$("body").css({overflow:"auto"})}function checkIfMobile(){return"xs"==$(".xyzzy:visible").attr("data-size")&&($("#interfaceContainer").removeClass("home-product"),$("#sumarID").addClass("hidden"),!0)}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function loadNewBackGround(){const e=Math.floor(16*Math.random()),n=document.querySelector(".home-product");n&&(n.style.backgroundImage=`url("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/img/background/${e}.jpg")`)}function getSettingsDataCmd(){if(ERROR_INSTANCE||!websck_is_connected)return;let e={REQUEST_INFO:2},n=JSON.stringify(e);websck_is_connected&&websocket.send(n),n=null,e=null,setTimeout(pool_info_page,1e3)}function decodeJalAutoMode(e){switch(e){case 0:return"STOP";case 1:return"OPEN MAX";case 2:return"CLOSE MAX";case 3:return"SYS AUTO";default:return"POSITION"}}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),checkIfMobile()||"index"!=PAGENAME&&"logs"!=PAGENAME||loadNewBackGround(),"index"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_index()),"settings"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_settings()),"logs"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_events()),setInterval(timerIncrement,6e4),$(this).mousemove(function(e){idleTime=0}),$(this).keypress(function(e){idleTime=0}),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",()=>{document.removeEventListener("visibilitychange",onVisibilityChange)})}),setTimeout(function(){var e=document.createElement("script");e.src="https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/js/sound_library.js",e.onload=function(){console.log("sound_library OK")},document.head.appendChild(e)},2e3);