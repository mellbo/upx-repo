var websocket,PAGENAME="",AddNewTemperatureInMonth="",resetThermostat=0,PREFERED_LIGHT_DORMITOR=0,LIVE_DORMITOR_LDR=0,idleTime=0,THERMOSTATLAST="",timers=[],intervals=[],gateway=window.location.port?`ws://${window.location.hostname}:${window.location.port}/ws`:`ws://${window.location.hostname}/ws`,websck_is_connected=!1,millis_esp=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=0,paginaVizibila=!0,USR_MAC="default",FIRST_INIT_LOGS=!0;const LIVE_DATA_TYPE=1,GET_DATA_TYPE=2,GET_DATA_QUICK=3,GET_DATA_LOGS=4,ONLY_PING=254;function inject_function_settings(){console.log("loading action and function settings"),window.setSlideValue=function(e,t,n){null!=e&&$(e).slider("setValue",n,!0),null!=t&&$(t).text($(e).val())},window.parseQuickSys=function(e){if(null==e)return;console.log(e);let t=0;const n=e.QUICKSYSTEM;1==n.hasOwnProperty("en_quick")&&(t=1),LIVE_DORMITOR_LDR=n.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR),t&&(console.log("Mark en_quick!"),$("#climatizareOption").val(n.CLIMA_MODE),$("#set_forceMainDoorOpen").prop("checked",n.forceMainDoorOpen),$("#force24Thermo").val(n.THERMOSTATFORCE24))},window.parseSettings=function(e){if(null==e)return;console.log(e);const t=e.SYSTEM;$("#set_THERMOSTAT_OUTSIDE_ENABLE").prop("checked",t.THERMOSTAT_OUTSIDE_ENABLE),$("#set_forceMainDoorOpen").prop("checked",t.forceMainDoorOpen),$("#set_AlowLightOFF").prop("checked",t.AlowLightOFF),$("#setKEY110_ENABLE").prop("checked",t.KEY110ENABLE),$("#setKEY120_ENABLE").prop("checked",t.KEY120ENABLE),$("#setKEY130_ENABLE").prop("checked",t.KEY130ENABLE),$("#setKEY255_ENABLE").prop("checked",t.KEY255ENABLE),$("#SetKEY110NAME").val(t.KEY110NAME),$("#SetKEY120NAME").val(t.KEY120NAME),$("#SetKEY130NAME").val(t.KEY130NAME),$("#SetKEY255NAME").val(t.KEY255NAME),$("#setLivoloTestID").val(t.LivoloTestID),$("#idMaxLogCnt").val(t.MaxLogCnt),setSlideValue("#set_CENTRALA_ON_HISTERIZIS","#param1Value",t.CENTRALA_ON_HISTERIZIS),setSlideValue("#set_TEMP_INDOOR_CALCULATION_METHOD","#param2Value",t.TEMP_INDOOR_CALCULATION_METHOD),setSlideValue("#set_jalAutoModeRun","#param3Value",t.jalAutoModeRun),setSlideValue("#set_LowLightPoint","#param4Value",t.LowLightPoint),setSlideValue("#set_jaluzHisterizis","#param5Value",t.jaluzHisterizis),setSlideValue("#set_FunTemperatureTrigger","#param6Value",t.FunTemperatureTrigger),PREFERED_LIGHT_DORMITOR=t.PREFERED_LIGHT_DORMITOR,THERMOSTATLAST=t.THERMOSTAT_LAST,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR),$("#beepModeID").val(t.UserBeepMode),(isLOCAL=e.isLOCAL)?$("#set_forceMainDoorOpen").prop("disabled",!1):$("#set_forceMainDoorOpen").prop("disabled",!0),$("#climatizareOption").val(t.CLIMA_MODE),$("#force24Thermo").val(t.THERMOSTATFORCE24),$("#smartWelcomeEnable").prop("checked",t.smartWelcomeEnable),$("#smartWelcomeAutoSetup").prop("checked",t.smartWelcomeAutoSetup),$("#welcome_Luni").val(t.Welcome_Time.day1),$("#welcome_Marti").val(t.Welcome_Time.day2),$("#welcome_Miercuri").val(t.Welcome_Time.day3),$("#welcome_Joi").val(t.Welcome_Time.day4),$("#welcome_Vineri").val(t.Welcome_Time.day5),$("#welcome_Sambata").val(t.Welcome_Time.day6),$("#welcome_Duminica").val(t.Welcome_Time.day7),$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1),$("#idPlsWait").addClass("hidden")},window.restoreESP=function(){let e={RESET:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is resetting and restarting, approximately 1 minute.\nAfter restoration, you may need to enter SAFEMODE\nto input the configuration data for Internet WIFI.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog after you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)},window.rebootESP=function(){let e={RESTART:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is restarting, 30 seconds.\nRefresh the page after the time has elapsed."),setTimeout(function(){location.reload()},3e3)},window.ClearData=function(){if(confirm("Do you really want to clear data on system ?")){let e={CLEAR_DATA:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("System data has been cleared. Setup again your system.\nSystem rebooting. Wait ~1 min for refresh."),setTimeout(function(){location.reload()},3e3)}},window.rebootInSafeMode=function(){ERROR_INSTANCE=1;let e={SAFEMODE:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is restarting and will run in AP-SAFEMODE.\nLook for the WIFI SSID 'UPX-SMARTHOME' and connect to it.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog after you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)},$("#set_THERMOSTAT_OUTSIDE_ENABLE").on("change",function(e){let t={THERMOSTAT_OUTSIDE_ENABLE:$("#set_THERMOSTAT_OUTSIDE_ENABLE").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#apply_CENTRALA_ON_HISTERIZIS").on("click",function(){let e={CENTRALA_ON_HISTERIZIS:parseFloat($("#set_CENTRALA_ON_HISTERIZIS").val())},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_CENTRALA_ON_HISTERIZIS").addClass("hidden")}),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").on("click",function(){let e={TEMP_INDOOR_CALCULATION_METHOD:parseInt($("#set_TEMP_INDOOR_CALCULATION_METHOD").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_TEMP_INDOOR_CALCULATION_METHOD").addClass("hidden")}),$("#apply_jalAutoModeRun").on("click",function(){let e={jalAutoModeRun:parseInt($("#set_jalAutoModeRun").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_jalAutoModeRun").addClass("hidden")}),$("#save_welcome_setup").on("click",function(){let e=[];e.push($("#welcome_Luni").val()),e.push($("#welcome_Marti").val()),e.push($("#welcome_Miercuri").val()),e.push($("#welcome_Joi").val()),e.push($("#welcome_Vineri").val()),e.push($("#welcome_Sambata").val()),e.push($("#welcome_Duminica").val());let t={save_welcome_setup:1,smartWelcomeEnable:$("#smartWelcomeEnable").is(":checked"),smartWelcomeAutoSetup:$("#smartWelcomeAutoSetup").is(":checked"),smartWelcomeTimes:e},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null,$("#smartWelcomeWindow").removeClass("in")}),$("#preff_ldr").on("click",function(){PREFERED_LIGHT_DORMITOR=LIVE_DORMITOR_LDR,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR);let e={PREFERED_LIGHT_DORMITOR:parseInt(PREFERED_LIGHT_DORMITOR,10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null}),$("#apply_LowLightPoint").on("click",function(){let e={LowLightPoint:parseInt($("#set_LowLightPoint").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_LowLightPoint").addClass("hidden")}),$("#apply_jaluzHisterizis").on("click",function(){let e={jaluzHisterizis:parseInt($("#set_jaluzHisterizis").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_jaluzHisterizis").addClass("hidden")}),$("#climatizareOption").on("change",function(e){let t=parseInt($(this).val(),10),n={CLIMA_MODE:parseInt(t,10)},o=JSON.stringify(n);websck_is_connected&&websocket.send(o),o=null,n=null}),$("#beepModeID").on("change",function(e){let t={UserBeepMode:parseInt($(this).val(),10)},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#set_forceMainDoorOpen").on("change",function(e){let t={forceMainDoorOpen:$(this).is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null,$("#set_forceMainDoorOpen").prop("disabled",!0),timers.push(setTimeout(function(){let e={forceMainDoorOpen:!1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#set_forceMainDoorOpen").prop("checked",!1),$("#set_forceMainDoorOpen").prop("disabled",!1)},3e3))}),$("#set_AlowLightOFF").on("change",function(e){let t={AlowLightOFF:$("#set_AlowLightOFF").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#apply_FunTemperatureTrigger").on("click",function(){let e={FunTemperatureTrigger:parseFloat($("#set_FunTemperatureTrigger").val())},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_FunTemperatureTrigger").addClass("hidden")}),$("#apply_LivoloTestID").on("click",function(){let e={LivoloTestID:parseInt($("#setLivoloTestID").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_LivoloTestID").addClass("hidden")}),$("#apply_MaxLogCnt").on("click",function(){let e={MaxLogCnt:parseInt($("#idMaxLogCnt").val(),10)},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_MaxLogCnt").addClass("hidden")}),$("#force24Thermo").on("change",function(e){let t={THERMOSTATFORCE24:parseInt($(this).val(),10)},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#setKEY110_ENABLE").on("change",function(e){let t={KEY110ENABLE:$("#setKEY110_ENABLE").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#setKEY120_ENABLE").on("change",function(e){let t={KEY120ENABLE:$("#setKEY120_ENABLE").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#setKEY130_ENABLE").on("change",function(e){let t={KEY130ENABLE:$("#setKEY130_ENABLE").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#setKEY255_ENABLE").on("change",function(e){let t={KEY255ENABLE:$("#setKEY255_ENABLE").is(":checked")},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null}),$("#apply_KEY110NAME").on("click",function(){let e={KEY110_NAME:$("#SetKEY110NAME").val()},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_KEY110NAME").addClass("hidden")}),$("#apply_KEY120NAME").on("click",function(){let e={KEY120_NAME:$("#SetKEY120NAME").val()},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_KEY120NAME").addClass("hidden")}),$("#apply_KEY130NAME").on("click",function(){let e={KEY130_NAME:$("#SetKEY130NAME").val()},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_KEY130NAME").addClass("hidden")}),$("#apply_KEY255NAME").on("click",function(){let e={KEY255_NAME:$("#SetKEY255NAME").val()},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,$("#apply_KEY255NAME").addClass("hidden")}),$("#SetKEY110NAME").on("input",function(e){$("#apply_KEY110NAME").removeClass("hidden")}),$("#SetKEY120NAME").on("input",function(e){$("#apply_KEY120NAME").removeClass("hidden")}),$("#SetKEY130NAME").on("input",function(e){$("#apply_KEY130NAME").removeClass("hidden")}),$("#SetKEY255NAME").on("input",function(e){$("#apply_KEY255NAME").removeClass("hidden")}),$("#set_NewTEMPInCALL").slider({id:"ex1Slider",min:5,max:50,step:.1,value:22,tooltip:"yes",tooltip_position:"top",handle:"triangle",focus:!1}),$("#set_NewTEMPInCALL").on("change",function(e){$("#gradeCelsius").val($(this).val())}),$("#set_CENTRALA_ON_HISTERIZIS").slider({id:"ex1Slider",min:.2,max:5,step:.1,value:.2,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_CENTRALA_ON_HISTERIZIS").on("change",function(e){$("#param1Value").text($(this).val()),$("#apply_CENTRALA_ON_HISTERIZIS").removeClass("hidden")}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").slider({id:"ex1Slider",min:0,max:5,step:1,value:1,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").on("change",function(e){$("#param2Value").text($(this).val()),$("#metodaCalculBtn").addClass("in"),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").removeClass("hidden")}),$("#set_jalAutoModeRun").slider({id:"ex1Slider",min:0,max:900,step:1,value:0,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jalAutoModeRun").on("change",function(e){$("#param3Value").text($(this).val()),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MROFF").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",0),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRUP").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",1),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRDOWN").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",2),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRAUTOMAT").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",3),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#set_LowLightPoint").slider({id:"ex1Slider",min:0,max:500,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_LowLightPoint").on("change",function(e){$("#param4Value").text($(this).val()),$("#apply_LowLightPoint").removeClass("hidden")}),$("#set_jaluzHisterizis").slider({id:"ex1Slider",min:0,max:200,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jaluzHisterizis").on("change",function(e){$("#param5Value").text($(this).val()),$("#apply_jaluzHisterizis").removeClass("hidden")}),$("#set_FunTemperatureTrigger").slider({id:"ex1Slider",min:20,max:50,step:.25,value:24,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_FunTemperatureTrigger").on("change",function(e){$("#param6Value").text($(this).val()),$("#apply_FunTemperatureTrigger").removeClass("hidden")}),$(".clockpicker").clockpicker({placement:"right",align:"right",autoclose:!0,default:"now",fromnow:0}),$(".addThermostat").on("change",function(e){var t=$("#gradeCelsius").val(),n=$("#dtPicker").val(),o="";""!=n&&null!==n&&""!=t&&null!==t?(o=n+":00\t"+t,$("#dtOut").text(o)):$("#dtOut").text("")}),$("#setLivoloTestID").on("change",function(e){$("#apply_LivoloTestID").removeClass("hidden")}),$("#idMaxLogCnt").on("change",function(e){$("#apply_MaxLogCnt").removeClass("hidden")}),$("#gradeCelsius").keyup(function(e){13===e.keyCode&&($("#set_NewTEMPInCALL").slider("setValue",$(this).val(),!0),$("#adaugaInThermostat").click())}),$("#btnKeyInfo").on("click",function(){getLogs("readKeys")}),$("#btnLogInfo").on("click",function(){getLogs("readInfo")}),$("#btnLogWarning").on("click",function(){getLogs("readWarning")}),$("#btnLogError").on("click",function(){getLogs("readError")}),$("#reload_callendar").on("click",function(e){loadCalendar()}),$("#del_itm_calendar").on("click",function(e){deleteItmCalendar($("#selCalendarItem option:selected").val())}),$("#adaugaInThermostat").on("click",function(e){var t=$("#dtOut").text();""!=t&&" "!=t&&null!=t&&"Ã—Completati ambele campuri."!=t?addInCallendar(t):$("#dtOut").html("<div style='width:400px;' class='alert alert-danger' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>Ã—</span></button><span>Completati ambele campuri.</span></div>")}),$("#save").on("click",function(){}),$("#reset_cal_month").on("click",function(){resetThermostat=1,saveSettings(),resetThermostat=0}),$("#reset_cal_all").on("click",function(){resetThermostat=2,saveSettings(),resetThermostat=0}),$("#smartWelcomeAutoSetup").on("change",function(e){$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1)}),document.getElementById("idRestoreESP").addEventListener("click",restoreESP),document.getElementById("idRebootESP").addEventListener("click",rebootESP),document.getElementById("idClearData").addEventListener("click",ClearData),document.getElementById("idBtnSafeMod").addEventListener("click",rebootInSafeMode)}function inject_function_index(){console.log("loading action and function index"),window.checkValueForBlink=function(e,t,n){var o=parseFloat(e);return o<t||o>n?"blink":""},window.temp_resimtita=function(e,t,n){return parseFloat(e+t/100*.33*6.105*Math.exp(17.27*e/(237.7+e))-.7*n-4).toFixed(2)},window.decodeJalModeNow=function(e){switch(e){case 0:return"MANUAL";case 1:return"AUTO";case 2:return"USER LDR";default:return e}},window.processCalorPos=function(e,t,n){var o="";return"1"==t&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #ff5c38;"></i>'),"2"==t&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #00fff0;"></i>'),t!=n&&(o='<i id="'+e+'" class="icon ion-ios-flame blink" style="margin: 0px 5px 0px;color: #ffcc1e;"></i>'),o},window.updLiveParamIndex=function(e){console.log(e);const t=e.live_data;var n,o,i,l,s,a,c,r,d,E,u,_,p="";o=t.CALOR1_SET_STATE,l=t.CALOR2_SET_STATE,a=t.CALOR3_SET_STATE,r=t.CALOR4_SET_STATE,E=t.CALOR5_SET_STATE,_=t.CALOR6_SET_STATE,n=t.CALOR1_CUR_STATE,i=t.CALOR2_CUR_STATE,s=t.CALOR3_CUR_STATE,c=t.CALOR4_CUR_STATE,d=t.CALOR5_CUR_STATE,u=t.CALOR6_CUR_STATE,p=checkValueForBlink(t.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+p+'">'+t.CALOR1_VCC+"mV</div>"),p=checkValueForBlink(t.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+p+'">'+t.CALOR2_VCC+"mV</div>"),p=checkValueForBlink(t.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+p+'">'+t.CALOR3_VCC+"mV</div>"),p=checkValueForBlink(t.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+p+'">'+t.CALOR4_VCC+"mV</div>"),p=checkValueForBlink(t.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+p+'">'+t.CALOR5_VCC+"mV</div>"),p=checkValueForBlink(t.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+p+'">'+t.CALOR6_VCC+"mV</div>"),$("#THERMOSTAT").html(t.THERMOSTAT),$("#TEMP_BUCATARIE").html(t.TEMP_BUCATARIE),$("#TEMP_DORMITOR").html("<div>"+t.TEMP_DORMITOR+"&nbsp;&nbsp;"+processCalorPos("cal6",d,E)+"</div>"),p=checkValueForBlink(t.HUM_DORMITOR2,20,65),$("#TEMP_DORMITOR2").html('<div class="'+p+'">'+t.TEMP_DORMITOR2+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HUM_DORMITOR2+"%&nbsp;&nbsp;"+processCalorPos("cal5",u,_)+"</div>"),p=checkValueForBlink(t.HOL_HUMIDITY,20,65),$("#TEMP_HOL").html('<div class="'+p+'">'+t.TEMP_HOL+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HOL_HUMIDITY+"%&nbsp;&nbsp;"+processCalorPos("cal1",n,o)+processCalorPos("cal2",i,l)+processCalorPos("cal3",s,a)+processCalorPos("cal4",c,r)+"</div>"),$("#TEMP_EXTERN").html(t.TEMP_EXTERN+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HUMIDITY_EXT+"%"),p=checkValueForBlink(t.VOLTAGE_BATTERY,12,13.9),$("#VOLTAGE_BATTERY").html('<div class="'+p+'">'+t.VOLTAGE_BATTERY+"</div>"),p=checkValueForBlink(t.VOLTAGE_RAIL12,11.8,12.5),$("#VOLTAGE_RAIL12").html('<div class="'+p+'">'+t.VOLTAGE_RAIL12+"</div>"),p=checkValueForBlink(t.VOLTAGE_MAIN,14.9,15.6),$("#VOLTAGE_MAIN").html('<div class="'+p+'">'+t.VOLTAGE_MAIN+"</div>"),$("#CentralaOn").html((t.CentralaOn?"DA":"NU")+" de "+t.IncalzireSecondsLastState),$("#ClimaON").html(t.ClimaOn?"DA":"NU"),$("#jalAutoModeRun").html(decodeJalAutoMode(t.jalAutoModeRun)),$("#LowLightPoint").html(t.LowLightPoint),$("#AlowLightOFF").html(t.AlowLightOFF?"DA":"NU"),$("#HomeIsAlone").html(t.HomeIsAlone?"DA":"NU"),$("#jaluzHisterizis").html(t.jaluzHisterizis),p=checkValueForBlink(t.KEY110BATTERY,2.75,3.3),$("#KEY110BATTERY").html('<div class="'+p+'">'+t.KEY110BATTERY+"</div>"),$("#KEY110LASTSEEN").html(t.KEY110LASTSEEN),$("#KEY110ENABLE").html(t.KEY110ENABLE?"DA":"NU"),$("#KEY110HOME").html((t.KEY110HOME?"DA":"NU")+", de "+t.KEY110LASTCHANGE),$("#KEY110NAME").html(t.KEY110NAME),p=checkValueForBlink(t.KEY120BATTERY,2.75,3.3),$("#KEY120BATTERY").html('<div class="'+p+'">'+t.KEY120BATTERY+"</div>"),$("#KEY120LASTSEEN").html(t.KEY120LASTSEEN),$("#KEY120ENABLE").html(t.KEY120ENABLE?"DA":"NU"),$("#KEY120HOME").html((t.KEY120HOME?"DA":"NU")+", de "+t.KEY120LASTCHANGE),$("#KEY120NAME").html(t.KEY120NAME),p=checkValueForBlink(t.KEY130BATTERY,2.75,3.3),$("#KEY130BATTERY").html('<div class="'+p+'">'+t.KEY130BATTERY+"</div>"),$("#KEY130LASTSEEN").html(t.KEY130LASTSEEN),$("#KEY130ENABLE").html(t.KEY130ENABLE?"DA":"NU"),$("#KEY130HOME").html((t.KEY130HOME?"DA":"NU")+", de "+t.KEY130LASTCHANGE),$("#KEY130NAME").html(t.KEY130NAME),p=checkValueForBlink(t.KEY255BATTERY,2.75,3.3),$("#KEY255BATTERY").html('<div class="'+p+'">'+t.KEY255BATTERY+"</div>"),$("#KEY255LASTSEEN").html(t.KEY255LASTSEEN),$("#KEY255ENABLE").html(t.KEY255ENABLE?"DA":"NU"),$("#KEY255HOME").html((t.KEY255HOME?"DA":"NU")+", de "+t.KEY255LASTCHANGE),$("#KEY255NAME").html(t.KEY255NAME),$("#TEMP_INDOOR_CALCULATION_METHOD").html(t.TEMP_INDOOR_CALCULATION_METHOD),$("#CENTRALA_ON_HISTERIZIS").html(t.CENTRALA_ON_HISTERIZIS),$("#THERMOSTAT_OUTSIDE_ENABLE").html(t.THERMOSTAT_OUTSIDE_ENABLE?"DA":"NU"),$("#TEMP_GATEWAY").html(t.TEMP_GATEWAY),$("#TEMP_MATRIX").html(temp_resimtita(parseFloat(t.MATRIX_INDOOR),parseFloat(t.HOL_HUMIDITY),.2)).toString(),$("#jalModeNow").html(decodeJalModeNow(t.jalModeNow)),LIVE_DORMITOR_LDR=t.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR),$("#outdoorLDR").html(t.outdoorLDR),$("#MATRIX_INDOOR").html(t.MATRIX_INDOOR),$("#jalAutoModeRunDSP").html(t.jalAutoModeRun),$("#updateTime").text(t.LocalTime),$("#idPlsWait").addClass("hidden")}}function inject_function_events(){console.log("loading action and function events"),window.parseErrorEvt=async function(e,t){let n;try{const e=await fetch("http://upx83.go.ro/upx-center/events/evt_translate.lst"),t=await e.text();n=new Function("return "+t)()}catch{return void console.log("Eroare la citire fisier")}function o(e,t,n=!1){switch(t){case"events_info":n?$("#idLogInfo").html(e):$("#idLogInfo").append("<br>"+e);break;case"events_warning":n?$("#idLogWarning").html(e):$("#idLogWarning").append("<br>"+e);break;case"events_error":n?$("#idLogError").html(e):$("#idLogError").append("<br>"+e);break;case"events_misc":n?$("#idLogMisc").html(e):$("#idLogMisc").append("<br>"+e);break;default:console.log("Err: type_events")}}function i(e){let t="";return e>=0&&(t=e>1?" :"+e.toString():" :"+(1===e?"True":"False")),t}function l(e,t,n){switch(t){case"events_info":switch(n){case 1:case 2:case 3:return": "+e.toString();case 4:return": "+decodeJalAutoMode(e);default:return i(e)}break;case"events_warning":case"events_error":case"events_misc":return i(e);default:console.log("Err: decodeEventValue type_events")}}let s=[t];"ALL_EVENTS"==t&&(s=["events_info","events_warning","events_error","events_misc"]),s.forEach(t=>{const i=e[t];if(i?.length)for(let e=0;e<i.length;e++){lineRaw=i[e];const s=lineRaw.split(",");let a=s[0],c=1*s[1].trim(),r="";r=l(1*s[2].trim(),t,c).toString(),o(a+":"+n[t][c]+r,t,!!!e)}else console.log("No event in array")})},window.loadEvents=function(e="ALL_EVENTS"){$.ajax({url:"http://upx83.go.ro/upx-center/events/event_server.php",type:"post",dataType:"json",cache:!1,timeout:2e3,data:{get_events_content:e,user_mac:USR_MAC},success:function(t){"ERROR"==t[0]?console.log(t[0],t[1]):parseErrorEvt(t[2],e)},error:function(e){console.log(e.responseText)}})}}function onOpen(e){websck_is_connected=1,"settings"==PAGENAME?(verificaVersiune(),getSettingsDataCmd()):setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),console.log("Connection opened")}function onClose(e){websck_is_connected=0,console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpen,websocket.onclose=onClose,websocket.onmessage=onMessage}function onMessage(e){let t=JSON.parse(e.data);if(1==t.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),t=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==t.hasOwnProperty("cMs")&&(millis_esp=parseInt(t.cMs,10)),1==t.hasOwnProperty("Local")&&(isLOCAL=t.Local),1==t.hasOwnProperty("SIGNALPWR")&&(RSSI=t.SIGNALPWR),1==t.hasOwnProperty("USR_MAC")&&(USR_MAC=t.USR_MAC);let n=document.getElementById("idcMillis");n&&(n.innerHTML=millis_esp+" - ðŸ“¶ "+RSSI+"%"),"index"==PAGENAME&&1==t.hasOwnProperty("live_data")&&updLiveParamIndex(t),"settings"==PAGENAME&&(1==t.hasOwnProperty("SYSTEM")&&parseSettings(t),1==t.hasOwnProperty("QUICKSYSTEM")&&parseQuickSys(t)),"logs"==PAGENAME&&"default"!=USR_MAC&&FIRST_INIT_LOGS&&(FIRST_INIT_LOGS=!1,timers.push(setTimeout(function(){loadEvents("ALL_EVENTS"),$("#idPlsWait").addClass("hidden")},500))),t=null}async function verificaVersiune(){let e="";const t=document.getElementById("idVersion");if(!t)return;e=t.innerHTML.trim();const n=await fetch("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/firmware/version"),o=await n.text(),i=Object.fromEntries(o.split("\n").map(e=>e.split("=").map(e=>e.trim())));if(console.log("Check VERSION.."),i.version!==e){console.log("Update available!");const e=document.getElementById("idNewFirmware");if(e){const t=document.getElementById("idNewFirmwareURL");t&&(t.href=i.url,e.classList.remove("hidden"))}}else console.log("No update available")}function onVisibilityChange(){paginaVizibila=!document.hidden,ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}function pool_info_page(){if(ERROR_INSTANCE||!websck_is_connected)return;let e=254;"index"==PAGENAME&&(e=1),"settings"==PAGENAME&&(e=3),"logs"==PAGENAME&&(e=4);let t={REQUEST_INFO:e},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null,websck_is_connected&&timers.push(setTimeout(function(){pool_info_page()},2e3))}function checkMillis(){if(ERROR_INSTANCE)return;let e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,timers.push(setTimeout(checkMillis,5e3)))}function timerIncrement(){(idleTime+=1)>30&&(idleTime=0,window.location.reload(!0)),idleTime>10?$("body").css({overflow:"hidden"}):$("body").css({overflow:"auto"})}function checkIfMobile(){return"xs"==$(".xyzzy:visible").attr("data-size")&&($("#interfaceContainer").removeClass("home-product"),$("#sumarID").addClass("hidden"),!0)}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function loadNewBackGround(){const e=Math.floor(16*Math.random()),t=document.querySelector(".home-product");t&&(t.style.backgroundImage=`url("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/img/background/${e}.jpg")`)}function getSettingsDataCmd(){if(ERROR_INSTANCE||!websck_is_connected)return;let e={REQUEST_INFO:2},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,setTimeout(pool_info_page,1e3)}function decodeJalAutoMode(e){switch(e){case 0:return"STOP";case 1:return"OPEN MAX";case 2:return"CLOSE MAX";case 3:return"SYSTEM";default:return"POSITION"}}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),checkIfMobile()||"index"!=PAGENAME&&"logs"!=PAGENAME||loadNewBackGround(),"index"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_index()),"settings"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_settings()),"logs"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_events()),setInterval(timerIncrement,6e4),$(this).mousemove(function(e){idleTime=0}),$(this).keypress(function(e){idleTime=0}),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",()=>{document.removeEventListener("visibilitychange",onVisibilityChange)})});