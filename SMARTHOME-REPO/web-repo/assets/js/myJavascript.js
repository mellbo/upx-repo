var websocket,PAGENAME="",PREFERED_LIGHT_DORMITOR=0,LIVE_DORMITOR_LDR=0,idleTime=0,timers=[],intervals=[],gateway=window.location.port?`ws://${window.location.hostname}:${window.location.port}/ws`:`ws://${window.location.hostname}/ws`,websck_is_connected=!1,millis_esp=0,WSCONNECTED=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=0,USR_MAC="00:00:00:00:00:00",FIRST_INIT_LOGS=!0,PAUSE_POOL_INFO=!1;const LIVE_DATA_TYPE=1,GET_DATA_TYPE=2,GET_DATA_QUICK=3,GET_DATA_LOGS=4,GET_DATA_SUMAR=5,ONLY_PING=254;function inject_function_settings(){console.log("loading action and function settings"),window.setIPToGroup=function(e,t){const n=document.querySelector(e);if(!n)return;const o=n.querySelectorAll("input[type=number]");for(let e=0;e<o.length&&e<t.length;e++){let n=parseInt(t[e])||0;n<0&&(n=0),n>255&&(n=255),o[e].value=n}},window.getIPFromGroup=function(e){const t=document.querySelector(e);if(!t)return null;const n=t.querySelectorAll("input[type=number]"),o=[];return n.forEach(e=>{let t=parseInt(e.value)||0;t<0&&(t=0),t>255&&(t=255),o.push(t)}),o},window.btnFuncAddInThermostat=function(){let e=window.hoursWheel.getSelected().toString().padStart(2,"0"),t=window.minutesWheel.getSelected().toString().padStart(2,"0"),n=window.horizontalWheel.getSelectedValue().toString();showConfirm("Introduceti temperatura "+n+" pentru ora "+(e+":"+t)+" ?",function(){let o={NewThermostatData:1,therm_hour:parseInt(e,10),therm_min:parseInt(t,10),therm_temp:parseFloat(parseFloat(n).toFixed(2))};window.sendQuickAct(o),$("#timePickerModal").modal("hide")},function(){})},window.btnFuncSelHHSmartWelcome=function(e){const t=window.hoursWheel.getSelected().toString().padStart(2,"0")+":"+window.minutesWheel.getSelected().toString().padStart(2,"0");document.getElementById(e).value=t,$("#timePickerModal").modal("hide")},window.confTmPckrOKBtn=function(e,t){let n=document.getElementById("timePickerOkBtn");n.onclick=null,n.onclick=function(){t&&t.length>0?e.apply(null,t):e()}},window.initTimePicker=function(){const e=Array.from({length:24},(e,t)=>t),t=Array.from({length:60},(e,t)=>t);window.hoursWheel=new WheelPicker("hoursWheel",e),window.minutesWheel=new WheelPicker("minutesWheel",t),window.horizontalWheel=new HorizontalWheelPicker({containerId:"H-wheel-container",min:12,max:38,step:.1,initialValue:12})},window.decodeThermLST=function(){const e=document.getElementById("selCalendarItem");if(!e||e.selectedIndex<0)return null;const t=e.options[e.selectedIndex].text;if(!t)return null;const n=t.match(/Ora:\s*(\d{2}):(\d{2})\s*Temperatura:\s*([\d.]+)/);if(n){return{tOra:parseInt(n[1],10),tMin:parseInt(n[2],10),tTemp:parseFloat(parseFloat(n[3]).toFixed(2))}}return null},window.openTimePicker=function(e){const t=document.getElementById(e).value.split(":"),n=parseInt(t[0],10),o=parseInt(t[1],10);window.hoursWheel.setSelected(n),window.minutesWheel.setSelected(o),document.getElementById("divTempHorizontal").classList.add("hidden"),$("#timePickerModal").modal("show")},window.openAddThermoPicker=function(e){let t=decodeThermLST();if(null!=t)window.hoursWheel.setSelected(t.tOra),window.minutesWheel.setSelected(t.tMin),window.horizontalWheel.setToValue(t.tTemp-.3);else{const t=new Date;window.hoursWheel.setSelected(t.getHours()),window.minutesWheel.setSelected(t.getMinutes()),window.horizontalWheel.setToValue(e-.3)}document.getElementById("divTempHorizontal").classList.remove("hidden"),$("#timePickerModal").modal("show")},window.setSlideValue=function(e,t,n){null!=e&&$(e).slider("setValue",n,!0),null!=t&&$(t).text($(e).val())},window.parseQuickSys=function(e){if(null==e)return;console.log(e);const t=e.QUICKSYSTEM;LIVE_DORMITOR_LDR=t.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR);let n=0;1==t.hasOwnProperty("en_quick")&&(n=1),n&&(console.log("Settings UPD"),$("#climatizareOption").val(t.CLIMA_MODE),$("#set_forceMainDoorOpen").prop("checked",t.forceMainDoorOpen),$("#force24Thermo").val(t.THERMOSTATFORCE24),info.play());let o=0;if(t.hasOwnProperty("ThermLST")&&(o=1),o){console.log("Thermostat UPD");const e=document.getElementById("selCalendarItem");e.innerHTML="";const n=t.ThermLST;n&&Array.isArray(n)&&n.forEach((t,n)=>{if(3===t.length){const[o,i,a]=t,l=document.createElement("option");l.value=n,l.text=`Ora: ${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")} Temperatura: ${a.toFixed(2)}`,e.appendChild(l)}}),info.play()}},window.parseSettings=function(e){if(null==e)return;console.log(e);const t=e.SYSTEM;$("#set_THERMOSTAT_OUTSIDE_ENABLE").prop("checked",t.THERMOSTAT_OUTSIDE_ENABLE),$("#set_forceMainDoorOpen").prop("checked",t.forceMainDoorOpen),$("#set_AlowLightOFF").prop("checked",t.AlowLightOFF),$("#setKEY110_ENABLE").prop("checked",t.KEY110ENABLE),$("#setKEY120_ENABLE").prop("checked",t.KEY120ENABLE),$("#setKEY130_ENABLE").prop("checked",t.KEY130ENABLE),$("#setKEY255_ENABLE").prop("checked",t.KEY255ENABLE),$("#setKEY110_PRINCIPAL").prop("checked",t.KEY110PRINCIPAL),$("#setKEY120_PRINCIPAL").prop("checked",t.KEY120PRINCIPAL),$("#setKEY130_PRINCIPAL").prop("checked",t.KEY130PRINCIPAL),$("#setKEY255_PRINCIPAL").prop("checked",t.KEY255PRINCIPAL),$("#SetKEY110NAME").val(t.KEY110NAME),$("#SetKEY120NAME").val(t.KEY120NAME),$("#SetKEY130NAME").val(t.KEY130NAME),$("#SetKEY255NAME").val(t.KEY255NAME),$("#setLivoloTestID").val(t.LivoloTestID),$("#idMaxLogCnt").val(t.MaxLogCnt),setSlideValue("#set_CENTRALA_ON_HISTERIZIS","#param1Value",t.CENTRALA_ON_HISTERIZIS),setSlideValue("#set_TEMP_INDOOR_CALCULATION_METHOD","#param2Value",t.TEMP_INDOOR_CALCULATION_METHOD),setSlideValue("#set_jalAutoModeRun","#param3Value",t.jalAutoModeRun),setSlideValue("#set_LowLightPoint","#param4Value",t.LowLightPoint),setSlideValue("#set_jaluzHisterizis","#param5Value",t.jaluzHisterizis),setSlideValue("#set_FunTemperatureTrigger","#param6Value",t.FunTemperatureTrigger),PREFERED_LIGHT_DORMITOR=t.PREFERED_LIGHT_DORMITOR,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR),$("#beepModeID").val(t.UserBeepMode),(isLOCAL=e.isLOCAL)?$("#set_forceMainDoorOpen").prop("disabled",!1):($("#set_forceMainDoorOpen").prop("disabled",!0),$("#set_forceMainDoorOpen").removeClass("btn-success"),$("#set_forceMainDoorOpen").addClass("btn-danger")),$("#climatizareOption").val(t.CLIMA_MODE),$("#force24Thermo").val(t.THERMOSTATFORCE24),$("#smartWelcomeEnable").prop("checked",t.smartWelcomeEnable),$("#smartWelcomeAutoSetup").prop("checked",t.smartWelcomeAutoSetup),$("#welcome_Luni").val(t.Welcome_Time.day1),$("#welcome_Marti").val(t.Welcome_Time.day2),$("#welcome_Miercuri").val(t.Welcome_Time.day3),$("#welcome_Joi").val(t.Welcome_Time.day4),$("#welcome_Vineri").val(t.Welcome_Time.day5),$("#welcome_Sambata").val(t.Welcome_Time.day6),$("#welcome_Duminica").val(t.Welcome_Time.day7),$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1);const n=document.getElementById("selCalendarItem");n.innerHTML="";const o=t.ThermLST;o&&Array.isArray(o)&&o.forEach((e,t)=>{if(3===e.length){const[o,i,a]=e,l=document.createElement("option");l.value=t,l.text=`Ora: ${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")} Temperatura: ${a.toFixed(2)}`,n.appendChild(l)}}),$("#setDHCP_OFF").prop("checked",t.IPMAN.DHCP_OFF),setIPToGroup("#ip-group",t.IPMAN.IP),setIPToGroup("#subnet-group",t.IPMAN.MASK),setIPToGroup("#gateway-group",t.IPMAN.GTWAY),$("#setDHCP_OFF").is(":checked")?$(".dhcp_setup").prop("disabled",!1):$(".dhcp_setup").prop("disabled",!0),$("#idPlsWait").addClass("hidden")},window.restoreESP=function(){if(confirm("Do you really want to clear data on system\nand Restore to Default ?")){let e={RESET:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is resetting and restarting, approximately 1 minute.\nAfter restoration, you may need to enter SAFEMODE\nto input the configuration data for Internet WIFI.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog after you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)}},window.rebootESP=function(){let e={RESTART:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is restarting, 30 seconds.\nRefresh the page after the time has elapsed."),setTimeout(function(){location.reload()},3e3)},window.ClearData=function(){if(confirm("Do you really want to clear data on system ?")){let e={CLEAR_DATA:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("System data has been cleared. Setup again your system.\nSystem rebooting. Wait ~1 min for refresh."),setTimeout(function(){location.reload()},3e3)}},window.rebootInSafeMode=function(){if(confirm("Do you really want to reboot in SAFEMODE ?")){ERROR_INSTANCE=1;let e={SAFEMODE:1},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,alert("The system is restarting and will run in AP-SAFEMODE.\nLook for the WIFI SSID 'UPX-SMARTHOME' and connect to it.\nMy address for AP is: http://192.168.1.1\n\nConfirm this dialog AFTER you are already connected to 'UPX-SMARTHOME'!"),setTimeout(function(){window.location.replace("http://192.168.1.1")},3e3)}},window.dtOutInfo=function(e){document.getElementById("dtOut").innerHTML="<div style='width:98%;' class='alert alert-danger' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>√ó</span></button><span>"+e+"</span></div>"},window.getMonthName=function(){let e="";return e=["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"][(new Date).getMonth()],e},window.showConfirm=function(e,t,n){let o=document.getElementById("modalOk"),i=document.getElementById("modalCancel");function a(){o.removeEventListener("click",l),i.removeEventListener("click",s)}function l(){$("#modalConfirm").modal("hide"),t(),a()}function s(){$("#modalConfirm").modal("hide"),n&&n(),a()}document.getElementById("modalMsg").innerHTML=e,null===n?i.classList.add("hidden"):i.classList.remove("hidden"),$("#modalConfirm").modal("show"),o.addEventListener("click",l),i.addEventListener("click",s)},window.sendQuickAct=function(e){if(!e||0===Object.keys(e).length)return void console.log("sendQuickAct:","err: no object to send!");let t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,data=null},window.getSettingsDataCmd=function(){if(ERROR_INSTANCE||!websck_is_connected)return;let e={REQUEST_INFO:2},t=JSON.stringify(e);websck_is_connected&&websocket.send(t),t=null,e=null,document.getElementById("infoCalMonth").innerHTML="Intrari in Termostat pentru luna "+getMonthName(),setTimeout(pool_info_page,1e3)},$("#set_THERMOSTAT_OUTSIDE_ENABLE").on("change",function(e){let t={THERMOSTAT_OUTSIDE_ENABLE:$("#set_THERMOSTAT_OUTSIDE_ENABLE").is(":checked")};sendQuickAct(t)}),$("#apply_CENTRALA_ON_HISTERIZIS").on("click",function(){let e={CENTRALA_ON_HISTERIZIS:parseFloat($("#set_CENTRALA_ON_HISTERIZIS").val())};sendQuickAct(e),$("#apply_CENTRALA_ON_HISTERIZIS").addClass("hidden")}),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").on("click",function(){let e={TEMP_INDOOR_CALCULATION_METHOD:parseInt($("#set_TEMP_INDOOR_CALCULATION_METHOD").val(),10)};sendQuickAct(e),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").addClass("hidden")}),$("#apply_jalAutoModeRun").on("click",function(){let e={jalAutoModeRun:parseInt($("#set_jalAutoModeRun").val(),10)};sendQuickAct(e),$("#apply_jalAutoModeRun").addClass("hidden")}),$("#save_welcome_setup").on("click",function(){let e=[];e.push($("#welcome_Luni").val()),e.push($("#welcome_Marti").val()),e.push($("#welcome_Miercuri").val()),e.push($("#welcome_Joi").val()),e.push($("#welcome_Vineri").val()),e.push($("#welcome_Sambata").val()),e.push($("#welcome_Duminica").val());let t={save_welcome_setup:1,smartWelcomeEnable:$("#smartWelcomeEnable").is(":checked"),smartWelcomeAutoSetup:$("#smartWelcomeAutoSetup").is(":checked"),smartWelcomeTimes:e};sendQuickAct(t),$("#smartWelcomeWindow").removeClass("in")}),$("#preff_ldr").on("click",function(){PREFERED_LIGHT_DORMITOR=LIVE_DORMITOR_LDR,$("#prefLDRShow").text(PREFERED_LIGHT_DORMITOR);let e={PREFERED_LIGHT_DORMITOR:parseInt(PREFERED_LIGHT_DORMITOR,10)};sendQuickAct(e)}),$("#apply_LowLightPoint").on("click",function(){let e={LowLightPoint:parseInt($("#set_LowLightPoint").val(),10)};sendQuickAct(e),$("#apply_LowLightPoint").addClass("hidden")}),$("#apply_jaluzHisterizis").on("click",function(){let e={jaluzHisterizis:parseInt($("#set_jaluzHisterizis").val(),10)};sendQuickAct(e),$("#apply_jaluzHisterizis").addClass("hidden")}),$("#climatizareOption").on("change",function(e){let t=parseInt($(this).val(),10),n={CLIMA_MODE:parseInt(t,10)};sendQuickAct(n)}),$("#beepModeID").on("change",function(e){let t=parseInt($(this).val(),10);sendQuickAct({UserBeepMode:t})}),$("#set_forceMainDoorOpen").on("click",function(e){let t={forceMainDoorOpen:!0},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null,$("#set_forceMainDoorOpen").prop("disabled",!0),$("#set_forceMainDoorOpen").removeClass("btn-success"),$("#set_forceMainDoorOpen").addClass("btn-danger"),timers.push(setTimeout(function(){sendQuickAct({forceMainDoorOpen:!1}),$("#set_forceMainDoorOpen").prop("disabled",!1),$("#set_forceMainDoorOpen").removeClass("btn-danger"),$("#set_forceMainDoorOpen").addClass("btn-success")},3e3))}),$("#set_AlowLightOFF").on("change",function(e){let t={AlowLightOFF:$("#set_AlowLightOFF").is(":checked")};sendQuickAct(t)}),$("#apply_FunTemperatureTrigger").on("click",function(){let e={FunTemperatureTrigger:parseFloat($("#set_FunTemperatureTrigger").val())};sendQuickAct(e),$("#apply_FunTemperatureTrigger").addClass("hidden")}),$("#apply_LivoloTestID").on("click",function(){let e={LivoloTestID:parseInt($("#setLivoloTestID").val(),10)};sendQuickAct(e),$("#apply_LivoloTestID").addClass("hidden")}),$("#apply_MaxLogCnt").on("click",function(){let e={MaxLogCnt:parseInt($("#idMaxLogCnt").val(),10)};sendQuickAct(e),$("#apply_MaxLogCnt").addClass("hidden")}),$("#force24Thermo").on("change",function(e){let t=parseInt($(this).val(),10);sendQuickAct({THERMOSTATFORCE24:t})}),$("#setKEY110_ENABLE").on("change",function(e){let t={KEY110ENABLE:$("#setKEY110_ENABLE").is(":checked")};sendQuickAct(t)}),$("#setKEY120_ENABLE").on("change",function(e){let t={KEY120ENABLE:$("#setKEY120_ENABLE").is(":checked")};sendQuickAct(t)}),$("#setKEY130_ENABLE").on("change",function(e){let t={KEY130ENABLE:$("#setKEY130_ENABLE").is(":checked")};sendQuickAct(t)}),$("#setKEY255_ENABLE").on("change",function(e){let t={KEY255ENABLE:$("#setKEY255_ENABLE").is(":checked")};sendQuickAct(t)}),$("#setKEY110_PRINCIPAL").on("change",function(e){let t={KEY110PRINCIPAL:$("#setKEY110_PRINCIPAL").is(":checked")};sendQuickAct(t)}),$("#setKEY120_PRINCIPAL").on("change",function(e){let t={KEY120PRINCIPAL:$("#setKEY120_PRINCIPAL").is(":checked")};sendQuickAct(t)}),$("#setKEY130_PRINCIPAL").on("change",function(e){let t={KEY130PRINCIPAL:$("#setKEY130_PRINCIPAL").is(":checked")};sendQuickAct(t)}),$("#setKEY255_PRINCIPAL").on("change",function(e){let t={KEY255PRINCIPAL:$("#setKEY255_PRINCIPAL").is(":checked")};sendQuickAct(t)}),$("#apply_KEY110NAME").on("click",function(){let e={KEY110_NAME:$("#SetKEY110NAME").val()};sendQuickAct(e),$("#apply_KEY110NAME").addClass("hidden")}),$("#apply_KEY120NAME").on("click",function(){let e={KEY120_NAME:$("#SetKEY120NAME").val()};sendQuickAct(e),$("#apply_KEY120NAME").addClass("hidden")}),$("#apply_KEY130NAME").on("click",function(){let e={KEY130_NAME:$("#SetKEY130NAME").val()};sendQuickAct(e),$("#apply_KEY130NAME").addClass("hidden")}),$("#apply_KEY255NAME").on("click",function(){let e={KEY255_NAME:$("#SetKEY255NAME").val()};sendQuickAct(e),$("#apply_KEY255NAME").addClass("hidden")}),$("#reload_callendar").on("click",function(e){PAUSE_POOL_INFO=!0,dtOutInfo("Wait to reload page..")}),$("#del_itm_calendar").on("click",function(e){let t=document.getElementById("selCalendarItem"),n=t.value,o=t.options[t.selectedIndex].text;0!=n?showConfirm("Doresti sa stergi pozitia #"+n+"<br>ref: "+o+" ?",function(){let e={CAL_DEL_ITEM:parseInt(n,10)};sendQuickAct(e),dtOutInfo("Pos <b>#"+n+"</b> was deleted from Calendar")},function(){}):showConfirm("Nu puteti sterge pozitia #0 din termostat.<br>Puteti insa modifica temperatura si ora.",function(){},null)}),$("#reset_cal_month").on("click",function(){showConfirm("Doresti sa resetezi la valorile initiale pentru luna<br>curenta din Calendar-Thermostat ?",function(){sendQuickAct({RST_CAL_CURMONTH:1}),dtOutInfo("Current month entry was reset.")},function(){})}),$("#reset_cal_all").on("click",function(){showConfirm("Doresti sa resetezi la valorile initiale pentru toate<br>lunile in Calendar-Thermostat ?",function(){sendQuickAct({RST_CAL_ALL:1}),dtOutInfo("RST All month in Calendar<br>System reboot now !")},function(){})}),$("#save_dhcp_mode").on("click",function(){showConfirm("Atentie. La urmatorul restart conectarea WLAN se va face<br>in baza IP/SUBNET/GATEWAY introduse!<br>Continuati ?",function(){let e={DHCP_OFF:$("#setDHCP_OFF").is(":checked"),IP:getIPFromGroup("#ip-group"),MASK:getIPFromGroup("#subnet-group"),GTWAY:getIPFromGroup("#gateway-group")};sendQuickAct({save_dhcp_mode:1,IPMAN:e})},function(){})}),$("#SetKEY110NAME").on("input",function(e){$("#apply_KEY110NAME").removeClass("hidden")}),$("#SetKEY120NAME").on("input",function(e){$("#apply_KEY120NAME").removeClass("hidden")}),$("#SetKEY130NAME").on("input",function(e){$("#apply_KEY130NAME").removeClass("hidden")}),$("#SetKEY255NAME").on("input",function(e){$("#apply_KEY255NAME").removeClass("hidden")}),$("#set_CENTRALA_ON_HISTERIZIS").slider({id:"ex1Slider",min:.2,max:5,step:.1,value:.2,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_CENTRALA_ON_HISTERIZIS").on("change",function(e){$("#param1Value").text($(this).val()),$("#apply_CENTRALA_ON_HISTERIZIS").removeClass("hidden")}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").slider({id:"ex1Slider",min:0,max:5,step:1,value:1,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_TEMP_INDOOR_CALCULATION_METHOD").on("change",function(e){$("#param2Value").text($(this).val());let t=document.getElementById("metodaCalculBtn");t.classList.add("in"),t.style.height=t.scrollHeight+"px",t.setAttribute("aria-expanded","true"),$("#apply_TEMP_INDOOR_CALCULATION_METHOD").removeClass("hidden")}),$("#set_jalAutoModeRun").slider({id:"ex1Slider",min:0,max:900,step:1,value:0,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jalAutoModeRun").on("change",function(e){$("#param3Value").text($(this).val()),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MROFF").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",0),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRUP").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",1),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRDOWN").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",2),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#MRAUTOMAT").on("click",function(e){setSlideValue("#set_jalAutoModeRun","#param3Value",3),$("#apply_jalAutoModeRun").removeClass("hidden")}),$("#set_LowLightPoint").slider({id:"ex1Slider",min:0,max:500,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_LowLightPoint").on("change",function(e){$("#param4Value").text($(this).val()),$("#apply_LowLightPoint").removeClass("hidden")}),$("#set_jaluzHisterizis").slider({id:"ex1Slider",min:0,max:200,step:1,value:20,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_jaluzHisterizis").on("change",function(e){$("#param5Value").text($(this).val()),$("#apply_jaluzHisterizis").removeClass("hidden")}),$("#set_FunTemperatureTrigger").slider({id:"ex1Slider",min:20,max:50,step:.25,value:24,tooltip:"yes",tooltip_position:"top",handle:"round",focus:!1}),$("#set_FunTemperatureTrigger").on("change",function(e){$("#param6Value").text($(this).val()),$("#apply_FunTemperatureTrigger").removeClass("hidden")}),$("#setLivoloTestID").on("change",function(e){$("#apply_LivoloTestID").removeClass("hidden")}),$("#idMaxLogCnt").on("change",function(e){$("#apply_MaxLogCnt").removeClass("hidden")}),$("#adaugaInThermostat").on("click",function(e){window.confTmPckrOKBtn(window.btnFuncAddInThermostat,[]),window.openAddThermoPicker(21.8)}),$("#save").on("click",function(){}),$("#smartWelcomeAutoSetup").on("change",function(e){$("#smartWelcomeAutoSetup").is(":checked")?(event.preventDefault(),$(".smartWelcome").prop("disabled",!0)):$(".smartWelcome").prop("disabled",!1)}),$(".smartWelcome").click(function(){if(!document.getElementById("smartWelcomeAutoSetup").checked){const e=this.id;window.confTmPckrOKBtn(window.btnFuncSelHHSmartWelcome,[e]),window.openTimePicker(e)}}),$(".dhcp_setup").on("input",function(){let e=$(this).val();e=e.replace(/\D/g,""),e.length>3&&(e=e.slice(0,3)),parseInt(e)>255&&(e="255"),$(this).val(e)}),$("#ip-group input[type=number]").on("blur",function(){let e=getIPFromGroup("#ip-group");e[3]=1,setIPToGroup("#gateway-group",e)}),$("#setDHCP_OFF").on("change",function(e){$("#setDHCP_OFF").is(":checked")?$(".dhcp_setup").prop("disabled",!1):$(".dhcp_setup").prop("disabled",!0)}),document.getElementById("idRestoreESP").addEventListener("click",restoreESP),document.getElementById("idRebootESP").addEventListener("click",rebootESP),document.getElementById("idClearData").addEventListener("click",ClearData),document.getElementById("idBtnSafeMod").addEventListener("click",rebootInSafeMode),initTimePicker()}function inject_function_index(){console.log("loading action and function index"),window.checkValueForBlink=function(e,t,n){var o=parseFloat(e);return o<t||o>n?"blink":""},window.temp_resimtita=function(e,t,n){return parseFloat(e+t/100*.33*6.105*Math.exp(17.27*e/(237.7+e))-.7*n-4).toFixed(2)},window.decodeJalModeNow=function(e){switch(e){case 0:return"MANUAL";case 1:return"AUTO";case 2:return"USER LDR";default:return e}},window.processCalorPos=function(e,t,n){var o="";return 1==t&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #ff5c38;"></i>'),2==t&&(o='<i id="'+e+'" class="icon ion-ios-flame" style="margin: 0px 5px 0px;color: #cecece;"></i>'),t!=n&&(o='<i id="'+e+'" class="icon ion-ios-flame blink" style="margin: 0px 5px 0px;color: #ffcc1e;"></i>'),0==t&&(o='<i id="'+e+'" class="icon ion-android-warning" style="margin: 0px 3px 0px;color: #ffffff;"></i>'),o},window.parseLiveParamIndex=function(e){console.log(e);const t=e.live_data;let n,o,i,a,l,s,r,c,d,u,E,p,m="";o=t.CALOR1_SET_STATE,a=t.CALOR2_SET_STATE,s=t.CALOR3_SET_STATE,c=t.CALOR4_SET_STATE,u=t.CALOR5_SET_STATE,p=t.CALOR6_SET_STATE,n=t.CALOR1_CUR_STATE,i=t.CALOR2_CUR_STATE,l=t.CALOR3_CUR_STATE,r=t.CALOR4_CUR_STATE,d=t.CALOR5_CUR_STATE,E=t.CALOR6_CUR_STATE,m=checkValueForBlink(t.CALOR1_VCC,2100,3300),$("#CALOR1_VCC").html('<div class="'+m+'">'+t.CALOR1_VCC+"mV</div>"),m=checkValueForBlink(t.CALOR2_VCC,2100,3300),$("#CALOR2_VCC").html('<div class="'+m+'">'+t.CALOR2_VCC+"mV</div>"),m=checkValueForBlink(t.CALOR3_VCC,2100,3300),$("#CALOR3_VCC").html('<div class="'+m+'">'+t.CALOR3_VCC+"mV</div>"),m=checkValueForBlink(t.CALOR4_VCC,2100,3300),$("#CALOR4_VCC").html('<div class="'+m+'">'+t.CALOR4_VCC+"mV</div>"),m=checkValueForBlink(t.CALOR5_VCC,2100,3300),$("#CALOR5_VCC").html('<div class="'+m+'">'+t.CALOR5_VCC+"mV</div>"),m=checkValueForBlink(t.CALOR6_VCC,2100,3300),$("#CALOR6_VCC").html('<div class="'+m+'">'+t.CALOR6_VCC+"mV</div>"),$("#THERMOSTAT").html(t.THERMOSTAT.toFixed(2)),$("#TEMP_BUCATARIE").html(t.TEMP_BUCATARIE.toFixed(2)),$("#TEMP_DORMITOR").html("<div>"+t.TEMP_DORMITOR.toFixed(2)+"&nbsp;&nbsp;"+processCalorPos("cal6",d,u)+"</div>"),m=checkValueForBlink(t.HUM_DORMITOR2,20,65),$("#TEMP_DORMITOR2").html('<div class="'+m+'">'+t.TEMP_DORMITOR2.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HUM_DORMITOR2+"%&nbsp;&nbsp;"+processCalorPos("cal5",E,p)+"</div>"),m=checkValueForBlink(t.HOL_HUMIDITY,20,65),$("#TEMP_HOL").html('<div class="'+m+'">'+t.TEMP_HOL.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HOL_HUMIDITY+"%&nbsp;&nbsp;"+processCalorPos("cal1",n,o)+processCalorPos("cal2",i,a)+processCalorPos("cal3",l,s)+processCalorPos("cal4",r,c)+"</div>"),$("#TEMP_EXTERN").html(t.TEMP_EXTERN.toFixed(2)+'&nbsp;&nbsp;<i class="icon ion-waterdrop"></i>'+t.HUMIDITY_EXT+"%"),m=checkValueForBlink(t.VOLTAGE_BATTERY,12,13.9),$("#VOLTAGE_BATTERY").html('<div class="'+m+'">'+t.VOLTAGE_BATTERY.toFixed(2)+"</div>"),m=checkValueForBlink(t.VOLTAGE_RAIL12,11.8,12.5),$("#VOLTAGE_RAIL12").html('<div class="'+m+'">'+t.VOLTAGE_RAIL12.toFixed(2)+"</div>"),m=checkValueForBlink(t.VOLTAGE_MAIN,14.9,15.6),$("#VOLTAGE_MAIN").html('<div class="'+m+'">'+t.VOLTAGE_MAIN.toFixed(2)+"</div>"),$("#CentralaOn").html((t.CentralaOn?"DA":"NU")+" de "+t.tmLstHeatChg),$("#ClimaON").html(t.ClimaOn?"DA":"NU"),$("#jalAutoModeRun").html(decodeJalAutoMode(t.jalAutoModeRun)),$("#LowLightPoint").html(t.LowLightPoint),$("#AlowLightOFF").html(t.AlowLightOFF?"DA":"NU"),$("#HomeIsAlone").html(t.HomeIsAlone?"DA":"NU"),$("#jaluzHisterizis").html(t.jaluzHisterizis),m=checkValueForBlink(t.KEY110BATTERY,2.75,3.3),$("#KEY110BATTERY").html('<div class="'+m+'">'+t.KEY110BATTERY+"</div>"),$("#KEY110LASTSEEN").html(t.KEY110LASTSEEN),$("#KEY110ENABLE").html(t.KEY110ENABLE?"DA":"NU"),$("#KEY110HOME").html((t.KEY110HOME?"DA":"NU")+", de "+t.KEY110LASTCHANGE),$("#KEY110NAME").html(t.KEY110NAME),m=checkValueForBlink(t.KEY120BATTERY,2.75,3.3),$("#KEY120BATTERY").html('<div class="'+m+'">'+t.KEY120BATTERY+"</div>"),$("#KEY120LASTSEEN").html(t.KEY120LASTSEEN),$("#KEY120ENABLE").html(t.KEY120ENABLE?"DA":"NU"),$("#KEY120HOME").html((t.KEY120HOME?"DA":"NU")+", de "+t.KEY120LASTCHANGE),$("#KEY120NAME").html(t.KEY120NAME),m=checkValueForBlink(t.KEY130BATTERY,2.75,3.3),$("#KEY130BATTERY").html('<div class="'+m+'">'+t.KEY130BATTERY+"</div>"),$("#KEY130LASTSEEN").html(t.KEY130LASTSEEN),$("#KEY130ENABLE").html(t.KEY130ENABLE?"DA":"NU"),$("#KEY130HOME").html((t.KEY130HOME?"DA":"NU")+", de "+t.KEY130LASTCHANGE),$("#KEY130NAME").html(t.KEY130NAME),m=checkValueForBlink(t.KEY255BATTERY,2.75,3.3),$("#KEY255BATTERY").html('<div class="'+m+'">'+t.KEY255BATTERY+"</div>"),$("#KEY255LASTSEEN").html(t.KEY255LASTSEEN),$("#KEY255ENABLE").html(t.KEY255ENABLE?"DA":"NU"),$("#KEY255HOME").html((t.KEY255HOME?"DA":"NU")+", de "+t.KEY255LASTCHANGE),$("#KEY255NAME").html(t.KEY255NAME),$("#TEMP_INDOOR_CALCULATION_METHOD").html(t.TEMP_INDOOR_CALCULATION_METHOD),$("#CENTRALA_ON_HISTERIZIS").html(t.CENTRALA_ON_HISTERIZIS.toFixed(2)),$("#THERMOSTAT_OUTSIDE_ENABLE").html(t.THERMOSTAT_OUTSIDE_ENABLE?"DA":"NU"),$("#TEMP_GATEWAY").html(t.TEMP_GATEWAY.toFixed(2)),$("#TEMP_MATRIX").html(temp_resimtita(parseFloat(t.MATRIX_INDOOR),parseFloat(t.HOL_HUMIDITY),.2)).toString(),$("#jalModeNow").html(decodeJalModeNow(t.jalModeNow)),LIVE_DORMITOR_LDR=t.dormitorLDR,$("#dormitorLDR").html(LIVE_DORMITOR_LDR),$("#outdoorLDR").html(t.outdoorLDR),$("#MATRIX_INDOOR").html(t.MATRIX_INDOOR),$("#jalAutoModeRunDSP").html(t.jalAutoModeRun),$("#updateTime").text(t.LocalTime),$("#idPriUsr").text(t.USR_PRINCIPAL_IN_HOME),$("#idLastUART").text(t.LAST_RCV_UART+"ms"),$("#idPlsWait").addClass("hidden")}}function inject_function_events(){console.log("loading action and function events"),window.formatTime=function(e){if("number"!=typeof e||Number.isNaN(e))return"Invalid";let t=Math.floor(e/86400),n=e%86400,o=Math.floor(n/3600);n%=3600;let i=Math.floor(n/60),a=n%60,l="";return t>0&&(l+=t+"D "),l+=String(o).padStart(2,"0")+":"+String(i).padStart(2,"0")+":"+String(a).padStart(2,"0"),l},window.parseErrorEvt=async function(e,t){let n;try{const e=await fetch("http://upx83.go.ro/upx-center/events/evt_translate.lst"),t=await e.text();n=new Function("return "+t)()}catch{return void console.log("Eroare la citire fisier")}function o(e,t,n=!1){switch(t){case"events_info":n?$("#idLogInfo").html(e):$("#idLogInfo").append("<br>"+e);break;case"events_warning":n?$("#idLogWarning").html(e):$("#idLogWarning").append("<br>"+e);break;case"events_error":n?$("#idLogError").html(e):$("#idLogError").append("<br>"+e);break;case"events_misc":n?$("#idLogMisc").html(e):$("#idLogMisc").append("<br>"+e);break;default:console.log("Err: type_events")}}function i(e){let t="";return e>=0&&(t=e>1?" :"+e.toString():" :"+(1===e?"True":"False")),t}function a(e,t,n,o){switch(n){case"events_info":switch(o){case 2:case 3:case 6:case 7:case 8:case 13:case 14:case 21:return": "+e.toString();case 9:switch(e){case 0:return": OPRITA";case 1:return": 21¬∫C";case 2:return": 22¬∫C";case 3:return": 23¬∫C";case 4:return": 24¬∫C";case 5:return": 24.5¬∫C";case 6:return": 25¬∫C";case 7:return": 25.5¬∫C";case 8:return": 26¬∫C";case 9:return": ENERGY SAViNG";case 10:return": Pornit 1 ora";case 11:return": AUTO HEATING"}break;case 10:switch(e){case 0:return": No Beep";case 1:return": System Beep";case 2:return": Warning Beep";case 3:return": All Beep"}break;case 4:return": "+decodeJalAutoMode(e);case 20:return": "+function(e){let t=e.toString();return 9!==t.length?"Err: numƒÉr invalid":`${t.substring(1,3)}:${t.substring(3,5)} ${(parseInt(t.substring(5,9))/100).toFixed(2)}¬∫C`}(e);default:return i(e)}break;case"events_warning":case"events_error":return i(e);case"events_misc":switch(o){case 0:case 1:case 2:case 3:return function(e){let t="";return t=" :"+(1===e?" JOIN":" LEAVE"),t}(e)+" dupa "+formatTime(t);default:return i(e)}break;default:console.log("Err: decodeEventValue type_events")}}let l=[t];"ALL_EVENTS"==t&&(l=["events_info","events_warning","events_error","events_misc"]),l.forEach(i=>{const l=e[i];if(l?.length){for(let e=0;e<l.length;e++){lineRaw=l[e];const t=lineRaw.split(",");let s=t[0],r=1*t[1].trim(),c="";c=a(1*t[2].trim(),1*t[3].trim(),i,r).toString(),o(s+":"+n[i][r]+c,i,!!!e)}"ALL_EVENTS"!=t&&("events_info"==i&&$("#idLogInfo").append("<br>‚ÑπÔ∏è Reload -INFO- Done."),"events_warning"==i&&$("#idLogWarning").append("<br>‚ÑπÔ∏è Reload -WARN- Done."),"events_error"==i&&$("#idLogError").append("<br>‚ÑπÔ∏è Reload -ERROR- Done."),"events_misc"==i&&$("#idLogMisc").append("<br>‚ÑπÔ∏è Reload -MISC- Done."))}else console.log("No event in array")})},window.loadEvents=function(e="ALL_EVENTS"){$.ajax({url:"http://upx83.go.ro/upx-center/events/event_server.php",type:"post",dataType:"json",cache:!1,timeout:2e3,data:{get_events_content:e,user_mac:USR_MAC},success:function(t){"ERROR"==t[0]?console.log(t[0],t[1]):parseErrorEvt(t[2],e)},error:function(e){console.log(e.responseText)}})},$("#btnKeyInfo").on("click",function(){loadEvents("events_misc"),info.play()}),$("#btnLogInfo").on("click",function(){loadEvents("events_info")}),$("#btnLogWarning").on("click",function(){loadEvents("events_warning")}),$("#btnLogError").on("click",function(){loadEvents("events_error")})}function onOpenWS(e){websck_is_connected=1,"settings"==PAGENAME?(verificaVersiune(),getSettingsDataCmd()):setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),console.log("Connection opened")}function onCloseWS(e){websck_is_connected=0,console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpenWS,websocket.onclose=onCloseWS,websocket.onmessage=onMessageWS}function onMessageWS(e){let t=JSON.parse(e.data);if(1==t.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),t=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==t.hasOwnProperty("cMs")&&(millis_esp=parseInt(t.cMs,10)),1==t.hasOwnProperty("Local")&&(isLOCAL=t.Local),1==t.hasOwnProperty("SIGNALPWR")&&(RSSI=t.SIGNALPWR),1==t.hasOwnProperty("USR_MAC")&&(USR_MAC=t.USR_MAC),1==t.hasOwnProperty("wsCnt")&&(WSCONNECTED=t.wsCnt);let n=document.getElementById("idcMillis");n&&(n.innerHTML=millis_esp+" - üì∂ "+RSSI+"% üî¥ LIVE ("+WSCONNECTED+")"),"index"==PAGENAME&&1==t.hasOwnProperty("live_data")&&parseLiveParamIndex(t),"settings"==PAGENAME&&(1==t.hasOwnProperty("SYSTEM")&&parseSettings(t),1==t.hasOwnProperty("QUICKSYSTEM")&&parseQuickSys(t)),"logs"==PAGENAME&&"default"!=USR_MAC&&FIRST_INIT_LOGS&&(FIRST_INIT_LOGS=!1,timers.push(setTimeout(function(){loadEvents("ALL_EVENTS"),$("#idPlsWait").addClass("hidden")},500))),t=null}async function verificaVersiune(){let e="";const t=document.getElementById("idVersion");if(!t)return;e=t.innerHTML.trim();const n=await fetch("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/firmware/version"),o=await n.text(),i=Object.fromEntries(o.split("\n").map(e=>e.split("=").map(e=>e.trim())));if(console.log("Check VERSION.."),i.version!==e){console.log("Update available!");const e=document.getElementById("idNewFirmware");if(e){const t=document.getElementById("idNewFirmwareURL");t&&(t.href=i.url,e.classList.remove("hidden"))}}else console.log("No update available")}function onVisibilityChange(){ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}function pool_info_page(){if(ERROR_INSTANCE||!websck_is_connected)return;if(!0===PAUSE_POOL_INFO)return;let e=254;"index"==PAGENAME&&(e=1),"settings"==PAGENAME&&(e=3),"logs"==PAGENAME&&(e=4);let t={REQUEST_INFO:e},n=JSON.stringify(t);websck_is_connected&&websocket.send(n),n=null,t=null,websck_is_connected&&timers.push(setTimeout(function(){pool_info_page()},2e3))}function checkMillis(){if(ERROR_INSTANCE)return;let e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,timers.push(setTimeout(checkMillis,5e3)))}function timerIncrement(){(idleTime+=1)>30&&(idleTime=0,window.location.reload(!0)),idleTime>10?$("body").css({overflow:"hidden"}):$("body").css({overflow:"auto"})}function checkIfMobile(){return"xs"==$(".xyzzy:visible").attr("data-size")&&($("#interfaceContainer").removeClass("home-product"),$("#sumarID").addClass("hidden"),!0)}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function loadNewBackGround(){const e=Math.floor(16*Math.random()),t=document.querySelector(".home-product");t&&(t.style.backgroundImage=`url("https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/img/background/${e}.jpg")`)}function decodeJalAutoMode(e){switch(e){case 0:return"STOP";case 1:return"OPEN MAX";case 2:return"CLOSE MAX";case 3:return"SYS AUTO";default:return"POSITION"}}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),checkIfMobile()||"index"!=PAGENAME&&"logs"!=PAGENAME||loadNewBackGround(),"index"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_index()),"settings"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_settings()),"logs"==PAGENAME&&($("#idPlsWait").removeClass("hidden"),inject_function_events()),setInterval(timerIncrement,6e4),$(this).mousemove(function(e){idleTime=0}),$(this).keypress(function(e){idleTime=0}),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",function(){document.removeEventListener("visibilitychange",onVisibilityChange)})}),setTimeout(function(){var e=document.createElement("script");e.src="https://mellbo.github.io/upx-repo/SMARTHOME-REPO/web-repo/assets/js/sound_library.js",e.onload=function(){console.log("sound_library OK")},document.body.appendChild(e)},3e3);