var websocket,DEBUG=1,PAGENAME="",gateway="ws://"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/ws",websck_is_connected=!1,millis_esp=0,WSCONNECTED=0,RSSI=0,isLOCAL=0,ERROR_INSTANCE=(WSCONNECTED=0,0),EN_SOUND=!1,LAST_ERRID=-1,ERRLST_EXTERMAL=null,GET_DATA_GRAPH=7;function onOpenWS(e){websck_is_connected=1,info_reboot_web(!1),setTimeout(pool_info_page,250),setTimeout(function(){checkMillis()},8e3),DEBUG&&console.log("Connection opened"),sendQuickAct({FORCE_INFO_NEWGRAPH:parseInt(-1,10)})}function onCloseWS(e){websck_is_connected=0,DEBUG&&console.log("Connection closed"),ERROR_INSTANCE||setTimeout(initWebSocket,2e3)}function initWebSocket(){DEBUG&&console.log("Trying to open a WebSocket connection..."),(websocket=new WebSocket(gateway)).onopen=onOpenWS,websocket.onclose=onCloseWS,websocket.onmessage=onMessageWS}function onMessageWS(e){var o=JSON.parse(e.data);if(DEBUG&&console.log(o),1==o.hasOwnProperty("ERROR_INSTANCE"))return ERROR_INSTANCE=1,websocket.close(),o=null,alert("You have to many page opened. Keep only one in your in browser or slow down action!"),void location.replace("/protection");1==o.hasOwnProperty("cMs")&&(millis_esp=parseInt(o.cMs,10)),1==o.hasOwnProperty("Local")&&(isLOCAL=o.Local),1==o.hasOwnProperty("SIGNALPWR")&&(RSSI=o.SIGNALPWR),1==o.hasOwnProperty("wsCnt")&&(WSCONNECTED=o.wsCnt);var n=document.getElementById("idcMillis");n&&(n.innerHTML=millis_esp+" - ðŸ“¶ "+RSSI+"% ðŸ”´ LIVE ("+WSCONNECTED+")");var i=-1;if("graph_data"==PAGENAME){if(1==o.hasOwnProperty("DATA_GRAPH")&&1==o.DATA_GRAPH.hasOwnProperty("DateOfJson")){o.DATA_GRAPH.DateOfJson;i=parseInt(o.DATA_GRAPH.IdxCurGraph,10),parseParamDataGraph(o.DATA_GRAPH)}1==o.hasOwnProperty("INDEX_GRAPH")&&parseIndexGraph(i,o.INDEX_GRAPH),$("#idPlsWait").addClass("hidden")}o=null}function pool_info_page(){if(!ERROR_INSTANCE&&websck_is_connected){var e={REQUEST_INFO:GET_DATA_GRAPH},o=JSON.stringify(e);websck_is_connected&&websocket.send(o),o=null,e=null,websck_is_connected&&setTimeout(function(){pool_info_page()},2e3)}}function checkMillis(){if(!ERROR_INSTANCE){var e=millis_esp;void 0===checkMillis.lastMillis&&(checkMillis.lastMillis=0),e===checkMillis.lastMillis?(info_reboot_web(!0),setTimeout(function(){window.location.reload(!0)},3e3)):(checkMillis.lastMillis=e,setTimeout(checkMillis,5e3))}}function info_reboot_web(e){switch(e){case!0:$("#idNoConnexion").removeClass("hidden"),DEBUG&&console.log("Rebooting WebPage");break;case!1:$("#idNoConnexion").addClass("hidden")}}function sendQuickAct(e){if(e&&0!==Object.keys(e).length){var o=JSON.stringify(e);DEBUG&&console.log("send->",o),websck_is_connected&&websocket.send(o),o=null,data=null}else DEBUG&&console.log("sendQuickAct:","err: no object to send!")}function parseParamDataGraph(e){null!=e&&graphNow(e)}function parseIndexGraph(e,o){var n=document.getElementById("idLstIdxGraph");n.innerHTML="",Array.isArray(o)&&o.length>0&&(-1===e&&(e=o.length-1),o.forEach(function(o,i){var t=document.createElement("option");t.value=i,t.text=o,i===e&&(t.selected=!0),n.appendChild(t)}))}function onVisibilityChange(){ERROR_INSTANCE=1,websocket.close(),location.replace("/protection")}function checkDevice(){!1!==window.oldDevice&&$(".clsDevForOld").addClass("clsDevOld disabled").find("a").on("click",function(e){e.preventDefault()})}function graphNow(e){if(null!=e){var o=document.getElementById("idGraphTemperature").querySelector("canvas"),n=o.getContext("2d");n.clearRect(0,0,o.width,o.height);var i={type:"line",data:{labels:[],datasets:[]},options:{animation:{easing:"linear",duration:1e3},maintainAspectRatio:!1,legend:{position:"bottom",display:!0,labels:{fontStyle:"normal",fontColor:"#ffffff",fontSize:18}},title:{fontStyle:"normal"},scales:{xAxes:[{gridLines:{color:"rgba(234, 236, 244, 0.5)",zeroLineColor:"rgba(234, 236, 244, 0.5)",drawBorder:!1,drawTicks:!0,borderDash:["1"],zeroLineBorderDash:["1"],drawOnChartArea:!0},ticks:{fontColor:"#ffcc1e",padding:20}}],yAxes:[{gridLines:{color:"rgba(234, 236, 244, 0.5)",zeroLineColor:"rgba(234, 236, 244, 0.5)",drawBorder:!1,drawTicks:!0,borderDash:["2"],zeroLineBorderDash:["2"]},ticks:{fontColor:"#ffcc1e",padding:20}}]}}},t=0,a=["rgba(255,76,103,0.05)","rgba(0,192,253,0.05)","rgba(255,182,193,0.05)","rgba(255,0,255,0.05)","rgba(255,30,233,0.05)"],s=["rgba(255,76,103,1.0)","rgba(0,192,253,1.0)","rgba(255,182,193,1.0)","rgba(255,0,255,1.0)","rgba(255,30,233,1.0)"];i.options.title={display:!0,text:e.DateOfJson.split(" ")[0],fontStyle:"normal",fontSize:22,fontColor:"#ffc700"},i.data.labels=e.labels,t=0,e.index.forEach(function(o){t<=5&&(i.data.datasets.push({label:o,fill:!0,steppedLine:e[o][0],pointRadius:2,pointHoverRadius:4,data:e[o][1],backgroundColor:a[t],borderColor:s[t],borderWidth:2}),t++)});new Chart(n,i)}else n.clearRect(0,0,o.width,o.height)}$(document).ready(function(){initWebSocket(),""==(PAGENAME=(PAGENAME=window.location.pathname).split("/").pop())&&(PAGENAME="index"),document.addEventListener("visibilitychange",onVisibilityChange),window.addEventListener("beforeunload",function(){document.removeEventListener("visibilitychange",onVisibilityChange)}),checkDevice(),$("#idPlsWait").removeClass("hidden")}),$("#idLstIdxGraph").on("change",function(e){var o=parseInt($(this).val(),10);sendQuickAct({FORCE_INFO_NEWGRAPH:parseInt(o,10)})}),$("#idRmvItem").on("click",function(e){var o=parseInt($("#idLstIdxGraph").val(),10);sendQuickAct({RMV_GRAPH_POS:parseInt(o,10)})});